<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Horas Extras - Wheel Tech</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #00ADEE 0%, #76B843 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 900px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #58595B 0%, #00ADEE 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .logo-container {
            margin-bottom: 15px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .logo-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .content {
            padding: 30px;
        }

        .screen {
            display: none;
        }

        .active {
            display: block;
        }

        .btn {
            background: linear-gradient(135deg, #00ADEE 0%, #76B843 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-full {
            width: 100%;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #58595B 0%, #808080 100%);
        }

        .btn-anuncios {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
        }

        .btn-atualizar {
            background: linear-gradient(135deg, #76B843 0%, #5A8A2A 100%);
        }

        .btn-comparar {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
        }

        /* Estilos para compara√ß√£o de pre√ßos */
        .comparacao-container {
            margin: 20px 0;
        }

        .produto-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .produto-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .produto-titulo {
            font-weight: bold;
            color: #58595B;
            font-size: 16px;
            flex: 1;
        }

        .produto-sku {
            font-size: 12px;
            color: #888;
            background: #f5f5f5;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .precos-comparacao {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .preco-plataforma {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .preco-ml {
            border-color: #FFE600;
            background: #FFFDE7;
        }

        .preco-shopee {
            border-color: #EE4D2D;
            background: #FFEBEE;
        }

        .plataforma-nome {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .preco-valor {
            font-size: 20px;
            font-weight: bold;
            margin: 8px 0;
        }

        .preco-ml .preco-valor {
            color: #2D3277;
        }

        .preco-shopee .preco-valor {
            color: #EE4D2D;
        }

        .diferenca {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
        }

        .diferenca-positiva {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .diferenca-negativa {
            background: #FFEBEE;
            color: #C62828;
        }

        .status-produto {
            font-size: 11px;
            margin-top: 5px;
            padding: 2px 6px;
            border-radius: 8px;
            display: inline-block;
        }

        .status-ativo {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .status-inativo {
            background: #FFEBEE;
            color: #C62828;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #58595B;
        }

        .error-message {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            color: #c62828;
            margin: 10px 0;
        }

        .success-message {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .contador-produtos {
            text-align: center;
            margin: 15px 0;
            color: #58595B;
            font-size: 14px;
            font-weight: bold;
        }

        .filtros-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #58595B;
            font-size: 14px;
        }

        select, input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            background: #e3f2fd;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #76B843;
        }

        .status-dot.loading {
            background: #FFA000;
            animation: pulse 1.5s infinite;
        }

        .status-dot.error {
            background: #f44336;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .resumo-comparacao {
            background: #F3F3F3;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .resumo-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .melhor-preco {
            font-weight: bold;
            color: #76B843;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">Wheel Tech</div>
                <div class="logo-subtitle">BICYCLING</div>
            </div>
            
            <h1>üè¢ Sistema Corporativo</h1>
            <p>Horas Extras + Compara√ß√£o de Pre√ßos</p>
        </div>

        <div class="content">
            <!-- Tela de Login -->
            <div id="loginScreen" class="screen active">
                <div class="form-group">
                    <label for="senha">üîë Senha do Funcion√°rio:</label>
                    <input type="password" id="senha" placeholder="Digite sua senha de 4 d√≠gitos" maxlength="4">
                </div>
                <button class="btn btn-full" onclick="fazerLogin()">Entrar no Sistema</button>
            </div>

            <!-- Menu Principal -->
            <div id="menuScreen" class="screen">
                <div class="user-welcome">
                    <h3>Ol√°, <span id="nomeFuncionario"></span>!</h3>
                    <p>Sal√°rio Base: R$ <span id="salarioBase"></span></p>
                    <div id="acessoAnuncios" style="display: none; margin-top: 10px; padding: 8px; background: #76B843; color: white; border-radius: 5px; font-size: 12px;">
                        ‚úÖ Acesso √† Compara√ß√£o de Pre√ßos
                    </div>
                </div>

                <div class="menu-buttons">
                    <button class="btn btn-full" onclick="mostrarTela('calcularScreen')">üìä Calcular Horas Extras + DSR</button>
                    <button class="btn btn-full" onclick="mostrarHistorico()">üìã Ver Meu Hist√≥rico</button>
                    <button class="btn btn-full" onclick="mostrarResumo()">‚ÑπÔ∏è Meu Resumo</button>
                    
                    <!-- Bot√£o de Compara√ß√£o de Pre√ßos -->
                    <button id="btnComparacao" class="btn btn-full btn-comparar" onclick="mostrarComparacaoPrecos()" style="display: none;">
                        üí∞ Compara√ß√£o de Pre√ßos
                    </button>
                    
                    <button class="btn btn-full btn-secondary" onclick="sair()">üö™ Sair do Sistema</button>
                </div>
            </div>

            <!-- Tela de Compara√ß√£o de Pre√ßos -->
            <div id="comparacaoScreen" class="screen">
                <h3 style="margin-bottom: 15px; color: #58595B;">üí∞ Compara√ß√£o de Pre√ßos</h3>
                <p style="margin-bottom: 15px; color: #58595B; font-size: 14px;">
                    Compara√ß√£o autom√°tica de pre√ßos entre Mercado Livre e Shopee
                </p>

                <div class="api-status">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Pronto para consultar</span>
                </div>

                <div class="filtros-container">
                    <div class="form-group">
                        <label for="filtroPlataforma">Plataforma:</label>
                        <select id="filtroPlataforma" onchange="filtrarProdutos()">
                            <option value="todos">Todas</option>
                            <option value="Mercado Livre">Mercado Livre</option>
                            <option value="Shopee">Shopee</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="filtroStatus">Status:</label>
                        <select id="filtroStatus" onchange="filtrarProdutos()">
                            <option value="todos">Todos</option>
                            <option value="ativo">Ativos</option>
                            <option value="inativo">Inativos</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="filtroMelhorPreco">Melhor Pre√ßo:</label>
                        <select id="filtroMelhorPreco" onchange="filtrarProdutos()">
                            <option value="todos">Todos</option>
                            <option value="ml">ML Mais Barato</option>
                            <option value="shopee">Shopee Mais Barato</option>
                        </select>
                    </div>
                </div>

                <button class="btn btn-full btn-atualizar" onclick="carregarTodosPrecos()">
                    üîÑ Atualizar Todos os Pre√ßos
                </button>

                <div id="resumoComparacao" class="resumo-comparacao" style="display: none;">
                    <h4 style="margin-bottom: 10px;">üìà Resumo da Compara√ß√£o</h4>
                    <div class="resumo-item">
                        <span>Total de Produtos:</span>
                        <span id="totalProdutos">0</span>
                    </div>
                    <div class="resumo-item">
                        <span>ML Mais Barato:</span>
                        <span id="mlMaisBarato" class="melhor-preco">0</span>
                    </div>
                    <div class="resumo-item">
                        <span>Shopee Mais Barato:</span>
                        <span id="shopeeMaisBarato" class="melhor-preco">0</span>
                    </div>
                    <div class="resumo-item">
                        <span>Economia M√©dia:</span>
                        <span id="economiaMedia" class="melhor-preco">R$ 0,00</span>
                    </div>
                </div>

                <div id="contadorProdutos" class="contador-produtos"></div>

                <div id="comparacaoContainer" class="comparacao-container">
                    <div class="loading" id="loadingComparacao">
                        üì° Preparando compara√ß√£o de pre√ßos...
                    </div>
                </div>

                <button class="btn btn-full btn-secondary" onclick="mostrarTela('menuScreen')">
                    ‚Üê Voltar ao Menu
                </button>
            </div>

            <!-- [Telas de Horas Extras permanecem iguais] -->
        </div>
    </div>

    <script>
        // Dados dos funcion√°rios
        const funcionarios = {
            "2209": {"nome": "Andressa Sloboda", "salario": 2223.90, "acessoAnuncios": true},
            "1809": {"nome": "Adryel Silva", "salario": 1098.48, "acessoAnuncios": false},
            "3003": {"nome": "Arthur Finkler", "salario": 2557.50, "acessoAnuncios": true},
            "0408": {"nome": "Bruna Jomek", "salario": 2223.90, "acessoAnuncios": true},
            "2411": {"nome": "Elaine Guidelli", "salario": 2640.00, "acessoAnuncios": false},
            "2701": {"nome": "Laura Souza", "salario": 2100.00, "acessoAnuncios": false},
            "1204": {"nome": "Thalyta Pampuch", "salario": 2223.90, "acessoAnuncios": true}
        };

        // URL da planilha
        const PLANILHA_URL = 'https://docs.google.com/spreadsheets/d/1zMa-RSRr53XpyVcaQu8WKvPZuqPKdseBNNZJNXUINmU/gviz/tq?tqx=out:json&sheet=P√°gina1';

        let funcionarioLogado = null;
        let historico = JSON.parse(localStorage.getItem('historicoHorasExtras')) || {};
        let todosProdutos = [];

        // Fun√ß√£o para extrair ID da Shopee da URL
        function extrairIdShopee(url) {
            const match = url.match(/\/(\d+)$/);
            return match ? match[1] : null;
        }

        // Fun√ß√£o para extrair Shop ID da Shopee da URL
        function extrairShopIdShopee(url) {
            const match = url.match(/product\/(\d+)\//);
            return match ? match[1] : null;
        }

        // API Mercado Livre
        async function buscarDadosML(mlb) {
            try {
                const response = await fetch(`https://api.mercadolibre.com/items/MLB${mlb}`);
                if (!response.ok) throw new Error('Produto n√£o encontrado no ML');
                
                const data = await response.json();
                return {
                    titulo: data.title,
                    preco: data.price,
                    status: data.status === 'active' ? 'ativo' : 'inativo',
                    vendas: data.sold_quantity || 0,
                    visualizacoes: data.visits || 0,
                    link: data.permalink
                };
            } catch (error) {
                console.error(`Erro ao buscar MLB ${mlb}:`, error);
                return null;
            }
        }

        // API Shopee (via scraping alternativo)
        async function buscarDadosShopee(shopeeUrl) {
            try {
                const itemid = extrairIdShopee(shopeeUrl);
                const shopid = extrairShopIdShopee(shopeeUrl);
                
                if (!itemid || !shopid) {
                    throw new Error('URL da Shopee inv√°lida');
                }

                // Tentativa de acesso √† API n√£o-oficial da Shopee
                const apiUrl = `https://shopee.com.br/api/v4/item/get?itemid=${itemid}&shopid=${shopid}`;
                
                const response = await fetch(apiUrl, {
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.data) {
                        return {
                            titulo: data.data.name,
                            preco: data.data.price / 100000, // Shopee usa centavos
                            status: 'ativo', // Assumindo ativo se encontrou
                            vendas: data.data.historical_sold || 0,
                            visualizacoes: data.data.view_count || 0
                        };
                    }
                }

                // Fallback: retornar dados b√°sicos
                return {
                    titulo: 'Produto Shopee',
                    preco: 0,
                    status: 'ativo',
                    vendas: 0,
                    visualizacoes: 0
                };

            } catch (error) {
                console.error(`Erro ao buscar Shopee ${shopeeUrl}:`, error);
                return null;
            }
        }

        // Carregar e comparar todos os pre√ßos
        async function carregarTodosPrecos() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const container = document.getElementById('comparacaoContainer');
            const loading = document.getElementById('loadingComparacao');

            statusDot.className = 'status-dot loading';
            statusText.textContent = 'Consultando APIs...';
            loading.innerHTML = 'üîÑ Consultando Mercado Livre e Shopee...';

            try {
                // Carregar dados da planilha
                const response = await fetch(PLANILHA_URL);
                const text = await response.text();
                const json = JSON.parse(text.substring(47).slice(0, -2));
                
                const rows = json.table.rows;
                todosProdutos = [];

                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    const cells = row.c;
                    
                    if (cells && cells.length >= 5) {
                        const shopeeUrl = cells[0]?.v;
                        const mlb = cells[3]?.v?.toString();
                        const sku = cells[2]?.v;

                        if (shopeeUrl && mlb) {
                            const produto = {
                                sku: sku || `SKU-${i}`,
                                shopeeUrl: shopeeUrl,
                                mlb: mlb,
                                mlData: null,
                                shopeeData: null
                            };

                            // Buscar dados do Mercado Livre
                            produto.mlData = await buscarDadosML(mlb);
                            
                            // Buscar dados da Shopee
                            produto.shopeeData = await buscarDadosShopee(shopeeUrl);

                            todosProdutos.push(produto);

                            // Atualizar status
                            statusText.textContent = `Processando ${i}/${rows.length-1} produtos...`;
                        }
                    }
                }

                statusDot.className = 'status-dot';
                statusText.textContent = `‚úÖ ${todosProdutos.length} produtos processados`;
                filtrarProdutos();
                atualizarResumoComparacao();

            } catch (error) {
                statusDot.className = 'status-dot error';
                statusText.textContent = '‚ùå Erro ao carregar pre√ßos';
                loading.innerHTML = `
                    <div class="error-message">
                        Erro: ${error.message}<br>
                        <small>Tentando carregar dados de exemplo...</small>
                    </div>
                `;
                
                // Carregar dados de exemplo em caso de erro
                carregarDadosExemplo();
            }
        }

        // [Restante do c√≥digo...]
    </script>
</body>
</html>