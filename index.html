<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Wheel Tech - BICYCLING</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #00ADEE 0%, #76B843 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #58595B 0%, #00ADEE 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #76B843;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-img {
            max-height: 60px;
            max-width: 200px;
            object-fit: contain;
        }

        .logo-text {
            font-size: 36px;
            font-weight: bold;
        }

        .logo-subtitle {
            font-size: 18px;
            opacity: 0.9;
            font-weight: 300;
        }

        .content {
            padding: 30px;
            min-height: 600px;
        }

        .screen {
            display: none;
        }

        .active {
            display: block;
        }

        .menu-departamentos {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .departamento-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .departamento-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .departamento-card.rh {
            border-left-color: #00ADEE;
        }

        .departamento-card.administrativo {
            border-left-color: #76B843;
        }

        .departamento-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .departamento-title {
            font-size: 20px;
            font-weight: bold;
            color: #58595B;
            margin-bottom: 10px;
        }

        .departamento-desc {
            color: #666;
            font-size: 14px;
        }

        .departamento-img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 15px;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 14px;
        }

        .menu-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #00ADEE 0%, #76B843 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 10px;
            text-align: center;
            display: block;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #58595B 0%, #808080 100%);
        }

        .btn-logout {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .btn-rh {
            background: linear-gradient(135deg, #00ADEE 0%, #0078A6 100%);
        }

        .btn-administrativo {
            background: linear-gradient(135deg, #76B843 0%, #5A8A2A 100%);
        }

        .user-welcome {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #80D6F7;
            border-radius: 10px;
            border-left: 4px solid #00ADEE;
        }

        .acesso-badge {
            margin-top: 10px;
            padding: 8px;
            background: #76B843;
            color: white;
            border-radius: 5px;
            font-size: 12px;
        }

        /* Estilos para os formul√°rios e outras telas */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #58595B;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #00ADEE;
        }

        .calculadora-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .resultado-container {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4caf50;
        }

        .historico-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .historico-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #00ADEE;
        }

        .comparacao-container {
            margin: 20px 0;
        }

        .produto-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .produto-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .produto-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .produto-titulo {
            font-weight: bold;
            color: #58595B;
            font-size: 18px;
            flex: 1;
        }

        .produto-sku {
            font-size: 12px;
            color: #888;
            background: #f5f5f5;
            padding: 4px 12px;
            border-radius: 10px;
        }

        .precos-comparacao {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .preco-plataforma {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .preco-ml {
            border-color: #FFE600;
            background: #FFFDE7;
        }

        .preco-shopee {
            border-color: #EE4D2D;
            background: #FFEBEE;
        }

        .plataforma-nome {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .preco-valor {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .preco-ml .preco-valor {
            color: #2D3277;
        }

        .preco-shopee .preco-valor {
            color: #EE4D2D;
        }

        .diferenca {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
        }

        .diferenca-positiva {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .diferenca-negativa {
            background: #FFEBEE;
            color: #C62828;
        }

        .status-produto {
            font-size: 11px;
            margin-top: 5px;
            padding: 2px 6px;
            border-radius: 8px;
            display: inline-block;
        }

        .status-ativo {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .status-inativo {
            background: #FFEBEE;
            color: #C62828;
        }

        .promocao-nome {
            font-size: 12px;
            color: #FF6B35;
            margin-top: 5px;
            font-weight: bold;
            background: #FFF3E0;
            padding: 3px 8px;
            border-radius: 6px;
            display: inline-block;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #e3f2fd;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #76B843;
        }

        .status-dot.loading {
            background: #FFA000;
            animation: pulse 1.5s infinite;
        }

        .status-dot.error {
            background: #f44336;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .btn-cadastrar {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
        }

        .btn-atualizar {
            background: linear-gradient(135deg, #76B843 0%, #5A8A2A 100%);
        }

        .btn-excel {
            background: linear-gradient(135deg, #217346 0%, #1E7E34 100%);
        }

        .btn-lista-produtos {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
        }

        .btn-monitoramento {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
        }

        .scraping-status {
            background: #fff3e0;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
        }

        .info-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            color: #6c757d;
        }

        .contador-produtos {
            text-align: center;
            margin: 20px 0;
            color: #58595B;
            font-size: 16px;
            font-weight: bold;
        }

        .auto-update-status {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .lista-rapida-produtos {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .produto-item-rapido {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .produto-info-rapido {
            flex: 1;
        }

        .produto-nome-rapido {
            font-weight: bold;
            color: #58595B;
            font-size: 14px;
        }

        .produto-sku-rapido {
            font-size: 11px;
            color: #888;
        }

        .produto-acoes-rapido {
            display: flex;
            gap: 5px;
        }

        .btn-pequeno {
            padding: 6px 10px;
            font-size: 11px;
            width: auto;
            margin: 0;
        }

        .preco-info {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .preco-carregado {
            color: #2E7D32;
        }

        .preco-pendente {
            color: #FF6B35;
        }

        .preco-original {
            text-decoration: line-through;
            color: #888;
            font-size: 14px;
        }

        .desconto-badge {
            background: #FF6B35;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            margin-left: 5px;
        }

        .valor-destaque {
            font-size: 24px;
            font-weight: bold;
            color: #2E7D32;
            margin: 10px 0;
        }

        .detalhes-calculo {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #00ADEE;
        }

        .linha-calculo {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Cabe√ßalho -->
        <div class="header">
            <div class="logo-container">
                <img src="logo inclinada.jpg" alt="Wheel Tech BICYCLING" class="logo-img">
                <div>
                    <div class="logo-text">Wheel Tech</div>
                    <div class="logo-subtitle">BICYCLING</div>
                </div>
            </div>
        </div>

        <!-- Conte√∫do -->
        <div class="content">
            <!-- Tela de Sele√ß√£o de Departamento -->
            <div id="departamentoScreen" class="screen active">
                <h3 style="text-align: center; margin-bottom: 30px; color: #58595B;">Selecione seu Departamento</h3>
                
                <div class="menu-departamentos">
                    <!-- Card RH -->
                    <div class="departamento-card rh" onclick="selecionarDepartamento('rh')">
                        <div class="departamento-icon">üìä</div>
                        <div class="departamento-title">RECURSOS HUMANOS</div>
                        <div class="departamento-desc">Gest√£o de horas extras, hist√≥rico e resumo</div>
                        <div class="departamento-img">
                            [Imagem do WhatsApp de 2025-10-24 √†(s) 13.19.06_88ae7acc.jpg]
                        </div>
                    </div>

                    <!-- Card Administrativo -->
                    <div class="departamento-card administrativo" onclick="selecionarDepartamento('administrativo')">
                        <div class="departamento-icon">üí∞</div>
                        <div class="departamento-title">ADMINISTRATIVO</div>
                        <div class="departamento-desc">Compara√ß√£o de pre√ßos e gest√£o de produtos</div>
                        <div class="departamento-img">
                            [Imagem do WhatsApp de 2025-10-24 √†(s) 13.19.06_88ae7acc.jpg]
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tela de Login -->
            <div id="loginScreen" class="screen">
                <h3 style="text-align: center; margin-bottom: 20px; color: #58595B;" id="loginTitle">Login</h3>
                
                <div class="form-group">
                    <label for="senha">üîë Senha do Funcion√°rio:</label>
                    <input type="password" id="senha" placeholder="Digite sua senha de 4 d√≠gitos" maxlength="4">
                </div>
                <button class="btn" onclick="fazerLogin()">Entrar no Sistema</button>
                <button class="btn btn-secondary" onclick="voltarParaDepartamentos()" style="margin-top: 10px;">
                    ‚Üê Voltar para Departamentos
                </button>
            </div>

            <!-- Tela RH -->
            <div id="rhScreen" class="screen">
                <div class="user-welcome">
                    <h3>Ol√°, <span id="nomeFuncionarioRH"></span>!</h3>
                    <div class="acesso-badge">üìä Departamento de RH</div>
                </div>

                <div class="menu-buttons">
                    <button class="btn btn-rh" onclick="mostrarTela('calcularScreen')">
                        ‚è∞ Calcular Horas Extras + DSR
                    </button>
                    <button class="btn btn-rh" onclick="mostrarHistorico()">
                        üìã Ver Meu Hist√≥rico
                    </button>
                    <button class="btn btn-rh" onclick="mostrarResumo()">
                        ‚ÑπÔ∏è Meu Resumo
                    </button>
                    <button class="btn btn-logout" onclick="sair()" style="margin-top: 30px;">üö™ Sair do Sistema</button>
                </div>
            </div>

            <!-- Tela Administrativo -->
            <div id="administrativoScreen" class="screen">
                <div class="user-welcome">
                    <h3>Ol√°, <span id="nomeFuncionarioAdm"></span>!</h3>
                    <div class="acesso-badge">üí∞ Departamento Administrativo</div>
                </div>

                <div class="menu-buttons">
                    <button class="btn btn-administrativo" onclick="mostrarComparacaoPrecos()">
                        üìà Compara√ß√£o de Pre√ßos
                    </button>
                    <button class="btn btn-logout" onclick="sair()" style="margin-top: 30px;">üö™ Sair do Sistema</button>
                </div>
            </div>

            <!-- Tela de C√°lculo de Horas Extras -->
            <div id="calcularScreen" class="screen">
                <h3 style="margin-bottom: 20px; color: #58595B;">‚è∞ Calcular Horas Extras + DSR</h3>
                
                <div class="calculadora-container">
                    <div class="form-group">
                        <label for="horasExtras">Horas Extras Trabalhadas:</label>
                        <input type="number" id="horasExtras" placeholder="Ex: 10" min="0" step="0.5">
                    </div>

                    <div class="form-group">
                        <label for="valorHora">Valor da Hora Normal (R$):</label>
                        <input type="number" id="valorHora" placeholder="Ex: 12.50" min="0" step="0.01">
                    </div>

                    <div class="form-group">
                        <label for="percentualHE">Percentual de Hora Extra (%):</label>
                        <select id="percentualHE">
                            <option value="50">50% - Hora Extra Normal</option>
                            <option value="100">100% - Hora Extra Feriado/Domingo</option>
                        </select>
                    </div>

                    <button class="btn btn-rh" onclick="calcularHorasExtras()">üìä Calcular</button>
                </div>

                <div id="resultadoCalculo" class="resultado-container" style="display: none;">
                    <h4 style="color: #2E7D32; margin-bottom: 15px;">üí∞ Resultado do C√°lculo</h4>
                    <div id="detalhesCalculo"></div>
                </div>

                <button class="btn btn-secondary" onclick="voltarParaArea()">‚Üê Voltar</button>
            </div>

            <!-- Tela de Compara√ß√£o de Pre√ßos -->
            <div id="comparacaoScreen" class="screen">
                <h3 style="margin-bottom: 15px; color: #58595B;">üí∞ Compara√ß√£o de Pre√ßos</h3>
                <p style="margin-bottom: 15px; color: #58595B; font-size: 14px;">
                    Compara√ß√£o autom√°tica entre Mercado Livre e Shopee com API Real
                </p>

                <div class="api-status">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Sistema de produtos interno</span>
                </div>

                <!-- Status do Monitoramento Autom√°tico -->
                <div class="auto-update-status" id="autoUpdateStatus" style="display: none;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <div class="status-dot loading" id="monitoramentoDot"></div>
                        <span id="monitoramentoText">Monitoramento autom√°tico ativo</span>
                    </div>
                    <div style="margin-top: 10px; font-size: 12px;">
                        Pr√≥xima atualiza√ß√£o em: <span id="proximaAtualizacao">--:--</span>
                    </div>
                </div>

                <!-- A√á√ÉO R√ÅPIDA - BOT√ïES ADICIONADOS -->
                <div class="action-buttons">
                    <button class="btn btn-cadastrar" onclick="mostrarTela('cadastroScreen')">
                        ‚ûï Cadastrar Produto
                    </button>
                    <button class="btn btn-lista-produtos" onclick="toggleListaProdutos()" id="btnListaProdutos">
                        üìã Lista de Produtos
                    </button>
                    <button class="btn btn-atualizar" onclick="atualizarPrecosAutomaticamente()">
                        üîÑ Atualizar Pre√ßos
                    </button>
                    <button class="btn btn-monitoramento" onclick="toggleMonitoramentoAutomatico()" id="btnMonitoramento">
                        ‚ö° Iniciar Monitoramento
                    </button>
                    <button class="btn btn-excel" onclick="exportarParaExcel()" id="btnExportarExcel">
                        üìä Exportar Excel
                    </button>
                </div>

                <!-- LISTA R√ÅPIDA DE PRODUTOS -->
                <div id="listaRapidaProdutos" class="lista-rapida-produtos" style="display: none;">
                    <h4 style="margin-bottom: 15px; color: #58595B;">üì¶ Produtos Cadastrados</h4>
                    <div id="conteudoListaRapida"></div>
                </div>

                <!-- Status do Scraping -->
                <div id="scrapingStatus" class="scraping-status" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="status-dot loading" id="scrapingDot"></div>
                        <span id="scrapingText">Iniciando atualiza√ß√£o de pre√ßos...</span>
                    </div>
                </div>

                <div id="contadorProdutos" class="contador-produtos">
                    üìä Sistema de produtos interno - Cadastre produtos para come√ßar
                </div>

                <div id="comparacaoContainer" class="comparacao-container">
                    <div class="info-card">
                        <p>Nenhum produto cadastrado ainda.</p>
                        <p><small>Clique em "Cadastrar Produto" para adicionar produtos ao sistema.</small></p>
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="voltarParaArea()">‚Üê Voltar</button>
            </div>

            <!-- Tela de Cadastro de Produtos -->
            <div id="cadastroScreen" class="screen">
                <h3 style="margin-bottom: 20px; color: #58595B;">‚ûï Cadastrar Produto</h3>
                
                <div class="form-group">
                    <label for="nomeProduto">Nome do Produto:</label>
                    <input type="text" id="nomeProduto" placeholder="Ex: Gancheira Mosso Odyssey Challenger">
                </div>

                <div class="form-group">
                    <label for="skuProduto">SKU/C√≥digo:</label>
                    <input type="text" id="skuProduto" placeholder="Ex: K33009">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group">
                        <label for="mlbProduto">MLB (Mercado Livre):</label>
                        <input type="text" id="mlbProduto" placeholder="Ex: MLB2106981701">
                        <small style="color: #666;">O pre√ßo ser√° buscado automaticamente via API</small>
                    </div>

                    <div class="form-group">
                        <label for="urlShopee">URL Shopee:</label>
                        <input type="text" id="urlShopee" placeholder="Ex: https://shopee.com.br/produto">
                        <small style="color: #666;">O pre√ßo ser√° buscado automaticamente via Web Scraping</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="statusProduto">Status do Produto:</label>
                    <select id="statusProduto">
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                    </select>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-cadastrar" onclick="cadastrarProduto()">
                        üíæ Salvar Produto
                    </button>
                    <button class="btn btn-secondary" onclick="mostrarTela('comparacaoScreen')">
                        ‚Üê Voltar
                    </button>
                </div>

                <div id="listaProdutosCadastrados" style="margin-top: 30px;">
                    <h4 style="margin-bottom: 15px; color: #58595B;">üìã Produtos Cadastrados</h4>
                    <div id="produtosCadastradosContainer"></div>
                </div>
            </div>

            <!-- Outras telas (Hist√≥rico, Resumo) -->
            <div id="historicoScreen" class="screen">
                <h3 style="margin-bottom: 20px; color: #58595B;">üìã Hist√≥rico de C√°lculos</h3>
                <div id="historicoContainer" class="historico-container"></div>
                <button class="btn btn-secondary" onclick="voltarParaArea()">‚Üê Voltar</button>
            </div>

            <div id="resumoScreen" class="screen">
                <h3 style="margin-bottom: 20px; color: #58595B;">‚ÑπÔ∏è Meu Resumo</h3>
                <div id="resumoContainer" class="info-card">
                    <p>Resumo do funcion√°rio em desenvolvimento...</p>
                </div>
                <button class="btn btn-secondary" onclick="voltarParaArea()">‚Üê Voltar</button>
            </div>
        </div>
    </div>

    <script>
        // Dados dos funcion√°rios
        const funcionarios = {
            "2209": {"nome": "Andressa Sloboda", "salario": 2223.90, "acessoAnuncios": true},
            "1809": {"nome": "Adryel Silva", "salario": 1098.48, "acessoAnuncios": false},
            "3003": {"nome": "Arthur Finkler", "salario": 2557.50, "acessoAnuncios": true},
            "0408": {"nome": "Bruna Jomek", "salario": 2223.90, "acessoAnuncios": true},
            "2411": {"nome": "Elaine Guidelli", "salario": 2640.00, "acessoAnuncios": false},
            "2701": {"nome": "Laura Souza", "salario": 2100.00, "acessoAnuncios": false},
            "1204": {"nome": "Thalyta Pampuch", "salario": 2223.90, "acessoAnuncios": true}
        };

        // CONFIGURA√á√ÉO DA API DO MERCADO LIVRE
        const ML_API_CONFIG = {
            accessToken: "APP_USR-6382303492960193-102410-577704e0d4d1ffc1957af5e23f94bf26-415176739",
            clientId: "6382303492960193",
            clientSecret: "J0eBOOjqAG60c1jiXZd0J9YXp76r5EPe",
            baseUrl: "https://api.mercadolibre.com"
        };

        // CONFIGURA√á√ÉO DO MONITORAMENTO AUTOM√ÅTICO (2 HORAS)
        const INTERVALO_ATUALIZACAO = 2 * 60 * 60 * 1000; // 2 horas em milissegundos

        let funcionarioLogado = null;
        let departamentoSelecionado = null;
        let historicoHorasExtras = JSON.parse(localStorage.getItem('historicoHorasExtras')) || {};
        let todosProdutos = JSON.parse(localStorage.getItem('produtosCadastrados')) || [];
        let produtoEditandoId = null;
        let monitoramentoAtivo = false;
        let intervaloMonitoramento = null;

        // üîÑ FUN√á√ÉO: Selecionar departamento
        function selecionarDepartamento(departamento) {
            departamentoSelecionado = departamento;
            document.getElementById('loginTitle').textContent = `Login - ${departamento.toUpperCase()}`;
            mostrarTela('loginScreen');
        }

        // üîÑ FUN√á√ÉO: Voltar para sele√ß√£o de departamentos
        function voltarParaDepartamentos() {
            mostrarTela('departamentoScreen');
        }

        // üîë FUN√á√ÉO: Login
        function fazerLogin() {
            const senha = document.getElementById('senha').value.trim();
            
            if (!senha) {
                alert('‚ùå Por favor, digite sua senha!');
                return;
            }

            if (funcionarios[senha]) {
                funcionarioLogado = {
                    senha: senha,
                    ...funcionarios[senha]
                };
                
                // Redireciona para a √°rea selecionada
                if (departamentoSelecionado === 'rh') {
                    document.getElementById('nomeFuncionarioRH').textContent = funcionarioLogado.nome;
                    mostrarTela('rhScreen');
                } else if (departamentoSelecionado === 'administrativo') {
                    document.getElementById('nomeFuncionarioAdm').textContent = funcionarioLogado.nome;
                    mostrarTela('administrativoScreen');
                }
                
                document.getElementById('senha').value = '';
                
            } else {
                alert('‚ùå Senha inv√°lida!');
            }
        }

        // üîô FUN√á√ÉO: Voltar para a √°rea do usu√°rio
        function voltarParaArea() {
            if (departamentoSelecionado === 'rh') {
                mostrarTela('rhScreen');
            } else if (departamentoSelecionado === 'administrativo') {
                mostrarTela('administrativoScreen');
            }
        }

        // üß≠ FUN√á√ÉO: Mostrar compara√ß√£o de pre√ßos
        function mostrarComparacaoPrecos() {
            if (!funcionarioLogado.acessoAnuncios) {
                alert('‚ùå Acesso n√£o autorizado!');
                return;
            }
            mostrarTela('comparacaoScreen');
            carregarProdutosInternos();
        }

        // ‚è∞ FUN√á√ÉO: Calcular horas extras + DSR
        function calcularHorasExtras() {
            const horasExtras = parseFloat(document.getElementById('horasExtras').value);
            const valorHora = parseFloat(document.getElementById('valorHora').value);
            const percentualHE = parseInt(document.getElementById('percentualHE').value);

            if (!horasExtras || !valorHora) {
                alert('‚ùå Por favor, preencha todos os campos!');
                return;
            }

            // C√°lculo da hora extra
            const valorHoraExtra = valorHora * (1 + percentualHE / 100);
            const totalHorasExtras = horasExtras * valorHoraExtra;

            // C√°lculo do DSR (1/6 das horas extras)
            const dsr = totalHorasExtras / 6;

            // Total geral
            const totalGeral = totalHorasExtras + dsr;

            // Exibir resultados
            const resultadoDiv = document.getElementById('resultadoCalculo');
            const detalhesDiv = document.getElementById('detalhesCalculo');

            detalhesDiv.innerHTML = `
                <div class="detalhes-calculo">
                    <div class="linha-calculo">
                        <span>Horas Extras Trabalhadas:</span>
                        <span><strong>${horasExtras} horas</strong></span>
                    </div>
                    <div class="linha-calculo">
                        <span>Valor da Hora Normal:</span>
                        <span><strong>R$ ${valorHora.toFixed(2)}</strong></span>
                    </div>
                    <div class="linha-calculo">
                        <span>Percentual de Hora Extra:</span>
                        <span><strong>${percentualHE}%</strong></span>
                    </div>
                    <div class="linha-calculo">
                        <span>Valor da Hora Extra:</span>
                        <span><strong>R$ ${valorHoraExtra.toFixed(2)}</strong></span>
                    </div>
                    <div class="linha-calculo" style="border-bottom: 2px solid #00ADEE;">
                        <span>Total Horas Extras:</span>
                        <span><strong>R$ ${totalHorasExtras.toFixed(2)}</strong></span>
                    </div>
                    <div class="linha-calculo">
                        <span>DSR (Descanso Semanal Remunerado):</span>
                        <span><strong>R$ ${dsr.toFixed(2)}</strong></span>
                    </div>
                    <div class="linha-calculo" style="font-size: 18px; font-weight: bold; color: #2E7D32;">
                        <span>TOTAL A RECEBER:</span>
                        <span>R$ ${totalGeral.toFixed(2)}</span>
                    </div>
                </div>
            `;

            resultadoDiv.style.display = 'block';

            // Salvar no hist√≥rico
            salvarNoHistorico(horasExtras, valorHora, percentualHE, totalGeral);
        }

        // üíæ FUN√á√ÉO: Salvar c√°lculo no hist√≥rico
        function salvarNoHistorico(horas, valorHora, percentual, total) {
            if (!historicoHorasExtras[funcionarioLogado.senha]) {
                historicoHorasExtras[funcionarioLogado.senha] = [];
            }

            const registro = {
                data: new Date().toLocaleString('pt-BR'),
                horas: horas,
                valorHora: valorHora,
                percentual: percentual,
                total: total
            };

            historicoHorasExtras[funcionarioLogado.senha].unshift(registro);
            
            // Manter apenas os √∫ltimos 50 registros
            if (historicoHorasExtras[funcionarioLogado.senha].length > 50) {
                historicoHorasExtras[funcionarioLogado.senha] = historicoHorasExtras[funcionarioLogado.senha].slice(0, 50);
            }

            localStorage.setItem('historicoHorasExtras', JSON.stringify(historicoHorasExtras));
        }

        // üìã FUN√á√ÉO: Mostrar hist√≥rico
        function mostrarHistorico() {
            mostrarTela('historicoScreen');
            const container = document.getElementById('historicoContainer');
            
            if (!historicoHorasExtras[funcionarioLogado.senha] || historicoHorasExtras[funcionarioLogado.senha].length === 0) {
                container.innerHTML = '<div class="info-card"><p>Nenhum c√°lculo realizado ainda.</p></div>';
                return;
            }

            container.innerHTML = historicoHorasExtras[funcionarioLogado.senha].map(registro => `
                <div class="historico-item">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>${registro.data}</strong>
                        <span style="color: #2E7D32; font-weight: bold;">R$ ${registro.total.toFixed(2)}</span>
                    </div>
                    <div style="font-size: 14px; color: #666; margin-top: 5px;">
                        ${registro.horas} horas √ó R$ ${registro.valorHora.toFixed(2)} (${registro.percentual}%)
                    </div>
                </div>
            `).join('');
        }

        // ‚ÑπÔ∏è FUN√á√ÉO: Mostrar resumo
        function mostrarResumo() {
            mostrarTela('resumoScreen');
            const container = document.getElementById('resumoContainer');
            
            const historicoUsuario = historicoHorasExtras[funcionarioLogado.senha] || [];
            const totalCalculos = historicoUsuario.length;
            const totalRecebido = historicoUsuario.reduce((sum, item) => sum + item.total, 0);

            container.innerHTML = `
                <h4 style="color: #58595B; margin-bottom: 20px;">Resumo de ${funcionarioLogado.nome}</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="text-align: center; padding: 15px; background: #E3F2FD; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #1976D2;">${totalCalculos}</div>
                        <div style="font-size: 14px; color: #666;">C√°lculos Realizados</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #E8F5E9; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #2E7D32;">R$ ${totalRecebido.toFixed(2)}</div>
                        <div style="font-size: 14px; color: #666;">Total em Horas Extras</div>
                    </div>
                </div>
                ${totalCalculos > 0 ? `
                    <div style="margin-top: 20px; padding: 15px; background: #FFF3E0; border-radius: 8px;">
                        <h5 style="color: #FF6B35; margin-bottom: 10px;">√öltimo C√°lculo</h5>
                        <div>Data: ${historicoUsuario[0].data}</div>
                        <div>Valor: R$ ${historicoUsuario[0].total.toFixed(2)}</div>
                    </div>
                ` : ''}
            `;
        }

        // üöÄ FUN√á√ÉO: Atualizar pre√ßos automaticamente - COM API REAL
        async function atualizarPrecosAutomaticamente() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const scrapingDiv = document.getElementById('scrapingStatus');
            const scrapingText = document.getElementById('scrapingText');
            
            statusDot.className = 'status-dot loading';
            statusText.textContent = 'Iniciando atualiza√ß√£o de pre√ßos...';
            scrapingDiv.style.display = 'block';
            scrapingText.textContent = 'Preparando busca de pre√ßos...';

            try {
                let produtosAtualizados = 0;
                let produtosComErro = 0;

                for (let i = 0; i < todosProdutos.length; i++) {
                    const produto = todosProdutos[i];
                    
                    statusText.textContent = `Atualizando ${i + 1}/${todosProdutos.length}`;
                    scrapingText.textContent = `Processando: ${produto.nome}`;
                    
                    let precoAtualizado = false;

                    // Buscar pre√ßo do Mercado Livre - COM API REAL
                    if (produto.mlb && produto.mlb.trim() !== '') {
                        try {
                            scrapingText.textContent = `Buscando ML: ${produto.nome}`;
                            const resultadoML = await buscarPrecoMercadoLivreAPI(produto.mlb);
                            if (resultadoML && resultadoML.precoPromocional > 0) {
                                produto.precoML = resultadoML.precoPromocional;
                                produto.precoOriginalML = resultadoML.precoOriginal;
                                produto.descontoML = resultadoML.desconto;
                                produto.promocaoNome = resultadoML.promocaoNome;
                                precoAtualizado = true;
                                console.log(`‚úÖ ML atualizado: ${produto.nome} - R$ ${resultadoML.precoPromocional} (Desconto: ${resultadoML.desconto}%)`);
                            }
                        } catch (error) {
                            console.error(`‚ùå Erro ML ${produto.nome}:`, error);
                            produtosComErro++;
                        }
                    }

                    // Buscar pre√ßo da Shopee - SEM SIMULA√á√ÉO
                    if (produto.urlShopee && produto.urlShopee.trim() !== '') {
                        try {
                            scrapingText.textContent = `Buscando Shopee: ${produto.nome}`;
                            const precoShopee = await buscarPrecoShopeeReal(produto.urlShopee);
                            if (precoShopee && precoShopee > 0) {
                                produto.precoShopee = precoShopee;
                                precoAtualizado = true;
                                console.log(`‚úÖ Shopee atualizado: ${produto.nome} - R$ ${precoShopee}`);
                            } else {
                                console.log(`‚ÑπÔ∏è Pre√ßo Shopee n√£o encontrado para: ${produto.nome}`);
                            }
                        } catch (error) {
                            console.error(`‚ùå Erro Shopee ${produto.nome}:`, error);
                            produtosComErro++;
                        }
                    }

                    if (precoAtualizado) {
                        produtosAtualizados++;
                        registrarMudancaPreco(produto);
                    }

                    // Delay entre requisi√ß√µes para n√£o sobrecarregar a API
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                localStorage.setItem('produtosCadastrados', JSON.stringify(todosProdutos));
                
                statusDot.className = 'status-dot';
                scrapingDiv.style.display = 'none';
                
                if (produtosAtualizados > 0) {
                    statusText.textContent = `‚úÖ ${produtosAtualizados} pre√ßos atualizados`;
                    if (produtosComErro > 0) {
                        statusText.textContent += ` | ${produtosComErro} erros`;
                    }
                } else {
                    statusText.textContent = `‚ÑπÔ∏è Nenhum pre√ßo novo encontrado`;
                    if (produtosComErro > 0) {
                        statusText.textContent += ` | ${produtosComErro} erros`;
                    }
                }
                
                carregarProdutosInternos();
                
            } catch (error) {
                statusDot.className = 'status-dot error';
                statusText.textContent = '‚ùå Erro na atualiza√ß√£o';
                document.getElementById('scrapingStatus').style.display = 'none';
                console.error('Erro geral na atualiza√ß√£o:', error);
            }
        }

        // üîç FUN√á√ÉO: Buscar pre√ßo do Mercado Livre usando API REAL - CORRIGIDA
        async function buscarPrecoMercadoLivreAPI(mlb) {
            // Limpar MLB - remover espa√ßos e caracteres especiais
            mlb = mlb.trim().replace(/[^a-zA-Z0-9]/g, '');
            
            if (!mlb.startsWith('MLB')) {
                mlb = 'MLB' + mlb;
            }

            console.log(`üîç Buscando pre√ßo ML via API para: ${mlb}`);

            try {
                const response = await fetch(`${ML_API_CONFIG.baseUrl}/items/${mlb}`, {
                    headers: {
                        'Authorization': `Bearer ${ML_API_CONFIG.accessToken}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üì¶ Dados recebidos da API ML:', data);
                
                let precoPromocional = data.price;
                let precoOriginal = data.original_price || data.price;
                let desconto = 0;
                let promocaoNome = null;
                
                // Calcular desconto se houver pre√ßo original diferente
                if (precoOriginal && precoOriginal > precoPromocional) {
                    desconto = Math.round(((precoOriginal - precoPromocional) / precoOriginal) * 100);
                }
                
                // Buscar informa√ß√µes de promo√ß√£o
                if (data.sale_terms && Array.isArray(data.sale_terms)) {
                    const saleTerm = data.sale_terms.find(term => term.id === 'SALE');
                    if (saleTerm) {
                        promocaoNome = saleTerm.value_name;
                    }
                }
                
                // Se n√£o encontrou promo√ß√£o, verificar se √© venda direta
                if (!promocaoNome && data.seller_address) {
                    promocaoNome = "Venda Direta";
                }
                
                console.log(`‚úÖ Pre√ßo ML encontrado via API: R$ ${precoPromocional} (Original: R$ ${precoOriginal}, ${desconto}% off)`);
                
                return {
                    precoPromocional: precoPromocional,
                    precoOriginal: precoOriginal,
                    desconto: desconto,
                    promocaoNome: promocaoNome
                };
                
            } catch (error) {
                console.error(`‚ùå Erro na API ML para ${mlb}:`, error);
                throw new Error(`Falha ao buscar pre√ßo do Mercado Livre: ${error.message}`);
            }
        }

        // üõçÔ∏è FUN√á√ÉO: Buscar pre√ßo da Shopee (sem simula√ß√£o)
        async function buscarPrecoShopeeReal(urlShopee) {
            if (!urlShopee || !urlShopee.includes('shopee')) {
                console.log('‚ùå URL da Shopee inv√°lida');
                return null;
            }

            console.log(`üõçÔ∏è Buscando pre√ßo Shopee: ${urlShopee}`);

            try {
                // Tentativa de web scraping real
                const preco = await buscarPrecoShopeeScraping(urlShopee);
                if (preco && preco > 0) {
                    return preco;
                } else {
                    console.log('‚ÑπÔ∏è Pre√ßo Shopee n√£o encontrado via scraping');
                    return null;
                }
            } catch (error) {
                console.error('‚ùå Erro no scraping Shopee:', error);
                return null;
            }
        }

        // üåê FUN√á√ÉO: Web scraping real da Shopee
        async function buscarPrecoShopeeScraping(urlShopee) {
            try {
                console.log(`üîç Iniciando scraping Shopee: ${urlShopee}`);
                
                // Usar proxy CORS
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const targetUrl = urlShopee;
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);

                const response = await fetch(proxyUrl + targetUrl, {
                    method: 'GET',
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
                        'Accept-Language': 'pt-BR,pt;q=0.9,en;q=0.8',
                    },
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const html = await response.text();
                
                // Padr√µes para extrair pre√ßo da Shopee
                const preco = extrairPrecoShopeeDoHTML(html);
                
                if (preco) {
                    console.log(`‚úÖ Pre√ßo Shopee encontrado: R$ ${preco}`);
                    return preco;
                } else {
                    throw new Error('Pre√ßo n√£o encontrado no HTML da Shopee');
                }
                
            } catch (error) {
                console.error('‚ùå Erro no scraping Shopee:', error);
                throw error;
            }
        }

        // üîç FUN√á√ÉO: Extrair pre√ßo do HTML da Shopee
        function extrairPrecoShopeeDoHTML(html) {
            // Padr√µes espec√≠ficos da Shopee
            const padroesPreco = [
                /"price":\s*(\d+)/g,
                /"price":\s*"(\d+)"/g,
                /"item_price":\s*(\d+)/g,
                /"item_price":\s*"(\d+)"/g,
                /"final_price":\s*(\d+)/g,
                /"final_price":\s*"(\d+)"/g,
                /"value":\s*"(\d+)"/g,
                /<span[^>]*class="[^"]*[Pp]rice[^"]*"[^>]*>[\s\S]*?R\$\s*([\d.,]+)/gi,
                /<div[^>]*class="[^"]*[Pp]rice[^"]*"[^>]*>[\s\S]*?R\$\s*([\d.,]+)/gi,
                /data-price="(\d+)"/g,
                /"sellerPrice":\s*"(\d+)"/g,
                /"originalPrice":\s*"(\d+)"/g
            ];

            for (let padrao of padroesPreco) {
                const matches = html.match(padrao);
                if (matches) {
                    for (let match of matches) {
                        const precoMatch = match.match(/(\d+)/);
                        if (precoMatch && precoMatch[1]) {
                            const preco = parseInt(precoMatch[1]) / 100;
                            // Valida√ß√£o do pre√ßo
                            if (preco > 10 && preco < 10000) {
                                console.log(`üí∞ Pre√ßo extra√≠do: R$ ${preco} (padr√£o: ${padrao})`);
                                return preco;
                            }
                        }
                    }
                }
            }
            
            // Tentar encontrar pre√ßo em formato brasileiro
            const precoBRL = html.match(/R\$\s*([\d.,]+)/gi);
            if (precoBRL) {
                for (let match of precoBRL) {
                    const valor = match.replace(/R\$\s*/, '').replace('.', '').replace(',', '.');
                    const preco = parseFloat(valor);
                    if (preco > 10 && preco < 10000) {
                        console.log(`üí∞ Pre√ßo BRL encontrado: R$ ${preco}`);
                        return preco;
                    }
                }
            }
            
            return null;
        }

        // üìã FUN√á√ÉO: Toggle da lista r√°pida de produtos
        function toggleListaProdutos() {
            const listaDiv = document.getElementById('listaRapidaProdutos');
            const btnLista = document.getElementById('btnListaProdutos');
            
            if (listaDiv.style.display === 'none') {
                carregarListaRapidaProdutos();
                listaDiv.style.display = 'block';
                btnLista.innerHTML = 'üìã Ocultar Lista';
                btnLista.style.background = 'linear-gradient(135deg, #58595B 0%, #808080 100%)';
            } else {
                listaDiv.style.display = 'none';
                btnLista.innerHTML = 'üìã Lista de Produtos';
                btnLista.style.background = 'linear-gradient(135deg, #FF6B35 0%, #F7931E 100%)';
            }
        }

        // üì¶ FUN√á√ÉO: Carregar lista r√°pida de produtos
        function carregarListaRapidaProdutos() {
            const container = document.getElementById('conteudoListaRapida');
            
            if (todosProdutos.length === 0) {
                container.innerHTML = '<div class="info-card"><p>Nenhum produto cadastrado ainda.</p></div>';
                return;
            }

            container.innerHTML = todosProdutos.map(produto => `
                <div class="produto-item-rapido">
                    <div class="produto-info-rapido">
                        <div class="produto-nome-rapido">${produto.nome}</div>
                        <div class="produto-sku-rapido">SKU: ${produto.sku} | MLB: ${produto.mlb || 'N√£o informado'}</div>
                        <div class="preco-info">
                            <span class="${produto.precoML > 0 ? 'preco-carregado' : 'preco-pendente'}">
                                ML: ${produto.precoML > 0 ? `R$ ${produto.precoML.toFixed(2)}` : 'N√£o carregado'}
                                ${produto.descontoML ? `<span class="desconto-badge">${produto.descontoML}% OFF</span>` : ''}
                            </span> | 
                            <span class="${produto.precoShopee > 0 ? 'preco-carregado' : 'preco-pendente'}">
                                Shopee: ${produto.precoShopee > 0 ? `R$ ${produto.precoShopee.toFixed(2)}` : 'N√£o carregado'}
                            </span>
                        </div>
                    </div>
                    <div class="produto-acoes-rapido">
                        <button class="btn btn-pequeno" onclick="editarProduto(${produto.id})" title="Editar produto">
                            ‚úèÔ∏è
                        </button>
                        <button class="btn btn-pequeno" onclick="excluirProduto(${produto.id})" title="Excluir produto">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ‚ö° FUN√á√ÉO: Toggle monitoramento autom√°tico (2 HORAS)
        function toggleMonitoramentoAutomatico() {
            const btnMonitoramento = document.getElementById('btnMonitoramento');
            const statusDiv = document.getElementById('autoUpdateStatus');
            
            if (!monitoramentoAtivo) {
                monitoramentoAtivo = true;
                btnMonitoramento.innerHTML = '‚è∏Ô∏è Pausar Monitoramento';
                btnMonitoramento.style.background = 'linear-gradient(135deg, #FF6B35 0%, #F7931E 100%)';
                statusDiv.style.display = 'block';
                
                // Executar primeira atualiza√ß√£o imediatamente
                atualizarPrecosAutomaticamente();
                
                // Configurar intervalo de 2 horas
                intervaloMonitoramento = setInterval(atualizarPrecosAutomaticamente, INTERVALO_ATUALIZACAO);
                atualizarProximaAtualizacao();
                
                alert('‚úÖ Monitoramento autom√°tico ativado! Os pre√ßos ser√£o atualizados a cada 2 horas.');
                
            } else {
                monitoramentoAtivo = false;
                btnMonitoramento.innerHTML = '‚ö° Iniciar Monitoramento';
                btnMonitoramento.style.background = 'linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%)';
                statusDiv.style.display = 'none';
                
                if (intervaloMonitoramento) {
                    clearInterval(intervaloMonitoramento);
                    intervaloMonitoramento = null;
                }
                
                alert('‚è∏Ô∏è Monitoramento autom√°tico pausado!');
            }
        }

        // üïí FUN√á√ÉO: Atualizar pr√≥xima atualiza√ß√£o
        function atualizarProximaAtualizacao() {
            const elemento = document.getElementById('proximaAtualizacao');
            if (elemento && monitoramentoAtivo) {
                const agora = new Date();
                const proxima = new Date(agora.getTime() + INTERVALO_ATUALIZACAO);
                elemento.textContent = proxima.toLocaleTimeString('pt-BR');
                
                // Atualizar a cada minuto
                setTimeout(atualizarProximaAtualizacao, 60000);
            }
        }

        // üíæ FUN√á√ÉO: Registrar mudan√ßa de pre√ßo no hist√≥rico
        function registrarMudancaPreco(produto) {
            let historicoPrecos = JSON.parse(localStorage.getItem('historicoPrecos')) || {};
            
            if (!historicoPrecos[produto.id]) {
                historicoPrecos[produto.id] = [];
            }
            
            const registro = {
                timestamp: new Date().toISOString(),
                data: new Date().toLocaleString('pt-BR'),
                precoML: produto.precoML,
                precoOriginalML: produto.precoOriginalML,
                descontoML: produto.descontoML,
                promocaoNome: produto.promocaoNome,
                precoShopee: produto.precoShopee,
                diferenca: produto.precoShopee - produto.precoML
            };
            
            historicoPrecos[produto.id].push(registro);
            
            if (historicoPrecos[produto.id].length > 100) {
                historicoPrecos[produto.id] = historicoPrecos[produto.id].slice(-100);
            }
            
            localStorage.setItem('historicoPrecos', JSON.stringify(historicoPrecos));
        }

        // üìä FUN√á√ÉO: Carregar produtos do sistema interno
        function carregarProdutosInternos() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const container = document.getElementById('comparacaoContainer');
            const contador = document.getElementById('contadorProdutos');

            statusDot.className = 'status-dot loading';
            statusText.textContent = 'Carregando produtos...';
            container.innerHTML = '';
            contador.textContent = 'üìä Carregando...';

            setTimeout(() => {
                statusDot.className = 'status-dot';
                
                if (todosProdutos.length > 0) {
                    const produtosComPrecoML = todosProdutos.filter(p => p.precoML > 0).length;
                    const produtosComPrecoShopee = todosProdutos.filter(p => p.precoShopee > 0).length;
                    
                    statusText.textContent = `‚úÖ ${todosProdutos.length} produtos carregados`;
                    contador.textContent = `üìä ${todosProdutos.length} produtos | ML: ${produtosComPrecoML} | Shopee: ${produtosComPrecoShopee}`;
                    
                    exibirProdutosComparacao();
                    
                } else {
                    statusText.textContent = '‚ÑπÔ∏è Nenhum produto cadastrado';
                    container.innerHTML = `
                        <div class="info-card">
                            <p>Nenhum produto cadastrado ainda.</p>
                            <p><small>Clique em "Cadastrar Produto" para adicionar produtos ao sistema.</small></p>
                        </div>
                    `;
                    contador.textContent = 'üìä Nenhum produto cadastrado';
                }
            }, 800);
        }

        // üìà FUN√á√ÉO: Exibir produtos na compara√ß√£o - ATUALIZADA
        function exibirProdutosComparacao() {
            const container = document.getElementById('comparacaoContainer');
            
            if (todosProdutos.length === 0) {
                container.innerHTML = '<div class="info-card"><p>Nenhum produto cadastrado.</p></div>';
                return;
            }

            container.innerHTML = todosProdutos.map(produto => {
                const diferenca = produto.precoShopee - produto.precoML;
                const temML = produto.precoML > 0;
                const temShopee = produto.precoShopee > 0;
                const temDescontoML = produto.descontoML > 0;
                const temPromocao = produto.promocaoNome;
                
                return `
                    <div class="produto-card">
                        <div class="produto-header">
                            <div class="produto-titulo">${produto.nome}</div>
                            <div class="produto-sku">${produto.sku}</div>
                        </div>
                        
                        <div class="precos-comparacao">
                            <div class="preco-plataforma preco-ml">
                                <div class="plataforma-nome">üõí Mercado Livre</div>
                                ${temML ? `
                                    ${temDescontoML ? `
                                        <div class="preco-original">De: R$ ${produto.precoOriginalML.toFixed(2)}</div>
                                    ` : ''}
                                    <div class="preco-valor">R$ ${produto.precoML.toFixed(2)}</div>
                                    ${temDescontoML ? `
                                        <div class="desconto-badge">${produto.descontoML}% OFF</div>
                                    ` : ''}
                                    ${temPromocao ? `
                                        <div class="promocao-nome">${produto.promocaoNome}</div>
                                    ` : ''}
                                    <div class="status-produto status-${produto.status}">${produto.status}</div>
                                    ${produto.mlb ? `<div style="font-size: 12px; color: #666;">MLB: ${produto.mlb}</div>` : ''}
                                    ${diferenca < 0 ? `<div class="diferenca diferenca-positiva">+R$ ${Math.abs(diferenca).toFixed(2)} mais barato</div>` : ''}
                                ` : `
                                    <div style="color: #888; padding: 10px;">
                                        Pre√ßo n√£o carregado
                                        ${produto.mlb ? `<br><small>MLB: ${produto.mlb}</small>` : ''}
                                    </div>
                                `}
                            </div>
                            
                            <div class="preco-plataforma preco-shopee">
                                <div class="plataforma-nome">üõçÔ∏è Shopee</div>
                                ${temShopee ? `
                                    <div class="preco-valor">R$ ${produto.precoShopee.toFixed(2)}</div>
                                    <div class="status-produto status-${produto.status}">${produto.status}</div>
                                    ${produto.urlShopee ? `<div style="font-size: 12px; color: #666;">URL: ${produto.urlShopee.substring(0, 30)}...</div>` : ''}
                                    ${diferenca > 0 ? `<div class="diferenca diferenca-positiva">+R$ ${diferenca.toFixed(2)} mais barato</div>` : ''}
                                ` : `
                                    <div style="color: #888; padding: 10px;">
                                        Pre√ßo n√£o carregado
                                        ${produto.urlShopee ? `<br><small>URL: ${produto.urlShopee.substring(0, 30)}...</small>` : ''}
                                    </div>
                                `}
                            </div>
                        </div>
                        
                        ${temML && temShopee ? `
                            <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666;">
                                üí∞ Diferen√ßa: R$ ${Math.abs(diferenca).toFixed(2)} | 
                                ${diferenca < 0 ? 'üõí ML mais barato' : diferenca > 0 ? 'üõçÔ∏è Shopee mais barato' : '‚öñÔ∏è Mesmo pre√ßo'}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // ‚ûï FUN√á√ÉO: Cadastrar produto
        function cadastrarProduto() {
            const nome = document.getElementById('nomeProduto').value.trim();
            const sku = document.getElementById('skuProduto').value.trim();
            const mlb = document.getElementById('mlbProduto').value.trim();
            const urlShopee = document.getElementById('urlShopee').value.trim();
            const status = document.getElementById('statusProduto').value;

            if (!nome) {
                alert('‚ùå Por favor, informe o nome do produto!');
                return;
            }

            if (!sku) {
                alert('‚ùå Por favor, informe o SKU do produto!');
                return;
            }

            let produtoAtualizado;

            if (produtoEditandoId) {
                produtoAtualizado = {
                    ...todosProdutos.find(p => p.id === produtoEditandoId),
                    nome: nome,
                    sku: sku,
                    mlb: mlb,
                    urlShopee: urlShopee,
                    status: status
                };

                todosProdutos = todosProdutos.map(p => p.id === produtoEditandoId ? produtoAtualizado : p);
                
            } else {
                const produtoExistente = todosProdutos.find(p => p.sku === sku);
                if (produtoExistente) {
                    alert('‚ùå J√° existe um produto com este SKU!');
                    return;
                }

                produtoAtualizado = {
                    id: Date.now(),
                    nome: nome,
                    sku: sku,
                    mlb: mlb,
                    precoML: 0,
                    precoOriginalML: 0,
                    descontoML: 0,
                    promocaoNome: null,
                    urlShopee: urlShopee,
                    precoShopee: 0,
                    status: status,
                    dataCadastro: new Date().toLocaleString('pt-BR')
                };

                todosProdutos.push(produtoAtualizado);
            }

            localStorage.setItem('produtosCadastrados', JSON.stringify(todosProdutos));

            document.getElementById('nomeProduto').value = '';
            document.getElementById('skuProduto').value = '';
            document.getElementById('mlbProduto').value = '';
            document.getElementById('urlShopee').value = '';
            document.getElementById('statusProduto').value = 'ativo';
            
            produtoEditandoId = null;

            alert(`‚úÖ Produto ${produtoEditandoId ? 'atualizado' : 'cadastrado'} com sucesso!`);
            
            atualizarListaProdutosCadastrados();
            
            // Atualizar lista r√°pida se estiver vis√≠vel
            if (document.getElementById('listaRapidaProdutos').style.display === 'block') {
                carregarListaRapidaProdutos();
            }
            
            mostrarTela('comparacaoScreen');
        }

        // üìã FUN√á√ÉO: Atualizar lista de produtos cadastrados
        function atualizarListaProdutosCadastrados() {
            const container = document.getElementById('produtosCadastradosContainer');
            
            if (todosProdutos.length === 0) {
                container.innerHTML = '<div class="info-card"><p>Nenhum produto cadastrado ainda.</p></div>';
                return;
            }

            container.innerHTML = todosProdutos.map(produto => `
                <div class="produto-card" style="margin-bottom: 10px;">
                    <div class="produto-header">
                        <div class="produto-titulo">${produto.nome}</div>
                        <div class="produto-sku">${produto.sku}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div>
                            <strong>Mercado Livre:</strong><br>
                            ${produto.mlb ? `MLB: ${produto.mlb}<br>` : ''}
                            ${produto.precoML > 0 ? `
                                ${produto.descontoML > 0 ? `
                                    <span class="preco-original">De: R$ ${produto.precoOriginalML.toFixed(2)}</span><br>
                                    <strong>Por: R$ ${produto.precoML.toFixed(2)}</strong>
                                    <span class="desconto-badge">${produto.descontoML}% OFF</span>
                                ` : `R$ ${produto.precoML.toFixed(2)}`}
                                ${produto.promocaoNome ? `<br><span class="promocao-nome">${produto.promocaoNome}</span>` : ''}
                            ` : 'Pre√ßo n√£o carregado'}
                        </div>
                        <div>
                            <strong>Shopee:</strong><br>
                            ${produto.urlShopee ? `URL: ${produto.urlShopee.substring(0, 30)}...<br>` : ''}
                            ${produto.precoShopee > 0 ? `R$ ${produto.precoShopee.toFixed(2)}` : 'Pre√ßo n√£o carregado'}
                        </div>
                    </div>
                    <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <span class="status-produto status-${produto.status}">${produto.status}</span>
                        <div>
                            <button class="btn" onclick="editarProduto(${produto.id})" style="margin-right: 5px; padding: 8px 12px; font-size: 12px;">
                                ‚úèÔ∏è Editar
                            </button>
                            <button class="btn" onclick="excluirProduto(${produto.id})" style="padding: 8px 12px; font-size: 12px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ‚úèÔ∏è FUN√á√ÉO: Editar produto
        function editarProduto(id) {
            const produto = todosProdutos.find(p => p.id === id);
            if (!produto) return;

            produtoEditandoId = produto.id;
            
            document.getElementById('nomeProduto').value = produto.nome;
            document.getElementById('skuProduto').value = produto.sku;
            document.getElementById('mlbProduto').value = produto.mlb || '';
            document.getElementById('urlShopee').value = produto.urlShopee || '';
            document.getElementById('statusProduto').value = produto.status;

            mostrarTela('cadastroScreen');
            window.scrollTo(0, 0);
        }

        // üóëÔ∏è FUN√á√ÉO: Excluir produto
        function excluirProduto(id) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                todosProdutos = todosProdutos.filter(produto => produto.id !== id);
                localStorage.setItem('produtosCadastrados', JSON.stringify(todosProdutos));
                atualizarListaProdutosCadastrados();
                carregarProdutosInternos();
                
                // Atualizar lista r√°pida se estiver vis√≠vel
                if (document.getElementById('listaRapidaProdutos').style.display === 'block') {
                    carregarListaRapidaProdutos();
                }
                
                alert('‚úÖ Produto exclu√≠do com sucesso!');
            }
        }

        // üìä FUN√á√ÉO: Exportar para Excel
        function exportarParaExcel() {
            if (todosProdutos.length === 0) {
                alert('‚ùå Nenhum produto cadastrado para exportar!');
                return;
            }

            let csv = 'Nome do Produto,SKU,MLB,Pre√ßo Original ML,Pre√ßo Promocional ML,Desconto ML,Nome Promo√ß√£o,URL Shopee,Pre√ßo Shopee,Status,Data Cadastro,Diferen√ßa,Melhor Pre√ßo\n';
            
            todosProdutos.forEach(produto => {
                const diferenca = produto.precoShopee - produto.precoML;
                const melhorPreco = diferenca < 0 ? 'Mercado Livre' : diferenca > 0 ? 'Shopee' : 'Empate';
                
                const linha = [
                    `"${produto.nome}"`,
                    `"${produto.sku}"`,
                    `"${produto.mlb || ''}"`,
                    produto.precoOriginalML > 0 ? produto.precoOriginalML.toFixed(2) : '0.00',
                    produto.precoML > 0 ? produto.precoML.toFixed(2) : '0.00',
                    produto.descontoML > 0 ? `${produto.descontoML}%` : '0%',
                    `"${produto.promocaoNome || ''}"`,
                    `"${produto.urlShopee || ''}"`,
                    produto.precoShopee > 0 ? produto.precoShopee.toFixed(2) : '0.00',
                    `"${produto.status}"`,
                    `"${produto.dataCadastro}"`,
                    diferenca.toFixed(2),
                    `"${melhorPreco}"`
                ].join(',');
                
                csv += linha + '\n';
            });

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `produtos_wheel_tech_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`‚úÖ ${todosProdutos.length} produtos exportados com sucesso!`);
        }

        // üß≠ FUN√á√ÉO: Navega√ß√£o entre telas
        function mostrarTela(telaId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(telaId).classList.add('active');
        }

        // üö™ FUN√á√ÉO: Sair do sistema
        function sair() {
            funcionarioLogado = null;
            departamentoSelecionado = null;
            mostrarTela('departamentoScreen');
        }

        // Event Listeners
        document.getElementById('senha').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') fazerLogin();
        });

        // Inicializa√ß√£o
        console.log('Sistema Wheel Tech - Com API Real do Mercado Livre!');
        console.log('Produtos cadastrados:', todosProdutos.length);
        
        // Mostrar bot√£o de exporta√ß√£o se houver produtos
        if (todosProdutos.length > 0) {
            document.getElementById('btnExportarExcel').style.display = 'block';
        }
    </script>
</body>
</html>