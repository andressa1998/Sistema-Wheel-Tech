<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Wheel Tech - BICYCLING</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #00ADEE 0%, #76B843 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #58595B 0%, #00ADEE 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #76B843;
        }

        .logo {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .logo-subtitle {
            font-size: 18px;
            opacity: 0.9;
            font-weight: 300;
        }

        .content {
            padding: 30px;
            min-height: 600px;
        }

        .screen {
            display: none;
        }

        .active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #58595B;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #00ADEE;
        }

        .btn {
            background: linear-gradient(135deg, #00ADEE 0%, #76B843 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 10px;
            text-align: center;
            display: block;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #58595B 0%, #808080 100%);
        }

        .btn-logout {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .btn-anuncios {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
        }

        .btn-atualizar {
            background: linear-gradient(135deg, #76B843 0%, #5A8A2A 100%);
        }

        .btn-excel {
            background: linear-gradient(135deg, #217346 0%, #1E7E34 100%);
        }

        .btn-cadastrar {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
        }

        .btn-lista-produtos {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
        }

        .btn-monitoramento {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
        }

        .btn-rh {
            background: linear-gradient(135deg, #00ADEE 0%, #0078A6 100%);
        }

        .btn-administrativo {
            background: linear-gradient(135deg, #76B843 0%, #5A8A2A 100%);
        }

        .user-welcome {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #80D6F7;
            border-radius: 10px;
            border-left: 4px solid #00ADEE;
        }

        .menu-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .departamento-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .departamento-rh {
            border-left-color: #00ADEE;
        }

        .departamento-administrativo {
            border-left-color: #76B843;
        }

        .departamento-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #58595B;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .acesso-badge {
            margin-top: 10px;
            padding: 8px;
            background: #76B843;
            color: white;
            border-radius: 5px;
            font-size: 12px;
        }

        .comparacao-container {
            margin: 20px 0;
        }

        .produto-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .produto-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .produto-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .produto-titulo {
            font-weight: bold;
            color: #58595B;
            font-size: 18px;
            flex: 1;
        }

        .produto-sku {
            font-size: 12px;
            color: #888;
            background: #f5f5f5;
            padding: 4px 12px;
            border-radius: 10px;
        }

        .precos-comparacao {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .preco-plataforma {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .preco-ml {
            border-color: #FFE600;
            background: #FFFDE7;
        }

        .preco-shopee {
            border-color: #EE4D2D;
            background: #FFEBEE;
        }

        .plataforma-nome {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .preco-valor {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .preco-ml .preco-valor {
            color: #2D3277;
        }

        .preco-shopee .preco-valor {
            color: #EE4D2D;
        }

        .diferenca {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
        }

        .diferenca-positiva {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .diferenca-negativa {
            background: #FFEBEE;
            color: #C62828;
        }

        .status-produto {
            font-size: 11px;
            margin-top: 5px;
            padding: 2px 6px;
            border-radius: 8px;
            display: inline-block;
        }

        .status-ativo {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .status-inativo {
            background: #FFEBEE;
            color: #C62828;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: #58595B;
        }

        .error-message {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: #c62828;
            margin: 10px 0;
        }

        .success-message {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .contador-produtos {
            text-align: center;
            margin: 20px 0;
            color: #58595B;
            font-size: 16px;
            font-weight: bold;
        }

        .filtros-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #e3f2fd;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #76B843;
        }

        .status-dot.loading {
            background: #FFA000;
            animation: pulse 1.5s infinite;
        }

        .status-dot.error {
            background: #f44336;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .resumo-comparacao {
            background: #F3F3F3;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            color: #6c757d;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #00ADEE;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .calculos-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .calculo-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #00ADEE;
        }

        .calculo-titulo {
            font-weight: bold;
            color: #58595B;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .calculo-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .calculo-total {
            font-weight: bold;
            font-size: 18px;
            color: #27ae60;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #27ae60;
        }

        .historico-precos {
            margin-top: 20px;
        }

        .historico-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .historico-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .historico-detalhes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 12px;
            color: #666;
        }

        .variacao-positiva {
            color: #2E7D32;
            font-weight: bold;
        }

        .variacao-negativa {
            color: #C62828;
            font-weight: bold;
        }

        .auto-update-status {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .lista-rapida-produtos {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .produto-item-rapido {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .produto-info-rapido {
            flex: 1;
        }

        .produto-nome-rapido {
            font-weight: bold;
            color: #58595B;
            font-size: 14px;
        }

        .produto-sku-rapido {
            font-size: 11px;
            color: #888;
        }

        .produto-acoes-rapido {
            display: flex;
            gap: 5px;
        }

        .btn-pequeno {
            padding: 6px 10px;
            font-size: 11px;
            width: auto;
            margin: 0;
        }

        .preco-info {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .preco-carregado {
            color: #2E7D32;
        }

        .preco-pendente {
            color: #FF6B35;
        }

        .scraping-status {
            background: #fff3e0;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Cabeçalho -->
        <div class="header">
            <div class="logo">Wheel Tech</div>
            <div class="logo-subtitle">BICYCLING</div>
        </div>

        <!-- Conteúdo -->
        <div class="content">
            <!-- Tela de Login -->
            <div id="loginScreen" class="screen active">
                <div class="form-group">
                    <label for="senha">🔑 Senha do Funcionário:</label>
                    <input type="password" id="senha" placeholder="Digite sua senha de 4 dígitos" maxlength="4">
                </div>
                <button class="btn" onclick="fazerLogin()">Entrar no Sistema</button>
            </div>

            <!-- Menu Principal -->
            <div id="menuScreen" class="screen">
                <div class="user-welcome">
                    <h3>Olá, <span id="nomeFuncionario"></span>!</h3>
                    <!-- Salário removido da tela principal -->
                    <div id="acessoAnuncios" class="acesso-badge" style="display: none;">
                        ✅ Acesso Administrativo
                    </div>
                </div>

                <!-- Seção RH -->
                <div class="departamento-section departamento-rh">
                    <div class="departamento-title">
                        📊 RECURSOS HUMANOS
                    </div>
                    <div class="menu-buttons">
                        <button class="btn btn-rh" onclick="mostrarTela('calcularScreen')">
                            ⏰ Calcular Horas Extras + DSR
                        </button>
                        <button class="btn btn-rh" onclick="mostrarHistorico()">
                            📋 Ver Meu Histórico
                        </button>
                        <button class="btn btn-rh" onclick="mostrarResumo()">
                            ℹ️ Meu Resumo
                        </button>
                    </div>
                </div>

                <!-- Seção Administrativo -->
                <div id="secaoAdministrativo" class="departamento-section departamento-administrativo" style="display: none;">
                    <div class="departamento-title">
                        💰 ADMINISTRATIVO
                    </div>
                    <div class="menu-buttons">
                        <button class="btn btn-administrativo" onclick="mostrarComparacaoPrecos()">
                            📈 Comparação de Preços
                        </button>
                    </div>
                </div>

                <button class="btn btn-logout" onclick="sair()">🚪 Sair do Sistema</button>
            </div>

            <!-- Tela de Cálculo de Horas -->
            <div id="calcularScreen" class="screen">
                <h3 style="margin-bottom: 20px; color: #58595B;">📊 Calcular Horas Extras + DSR</h3>
                
                <div class="form-group">
                    <label for="horasExtras">Quantidade de Horas Extras Trabalhadas:</label>
                    <input type="number" id="horasExtras" step="0.5" min="0.5" placeholder="Ex: 2.5" value="1">
                </div>

                <div class="form-group">
                    <label for="diasUteis">Dias Úteis no Mês:</label>
                    <input type="number" id="diasUteis" min="1" max="31" placeholder="Ex: 22" value="22">
                </div>

                <div class="form-group">
                    <label for="diasTrabalhados">Dias Trabalhados no Mês:</label>
                    <input type="number" id="diasTrabalhados" min="1" max="31" placeholder="Ex: 20" value="20">
                </div>

                <button class="btn" onclick="calcularHorasExtras()">Calcular Valor</button>
                <button class="btn btn-secondary" onclick="mostrarTela('menuScreen')">Voltar</button>

                <div id="resultadoCalculo" style="background: #e8f6f3; border-radius: 10px; padding: 20px; margin-top: 20px; display: none;">
                    <h4 style="color: #27ae60; margin-bottom: 15px;">✅ Cálculo Realizado</h4>
                    
                    <div class="calculos-grid">
                        <div class="calculo-card">
                            <div class="calculo-titulo">Horas Extras</div>
                            <div class="calculo-item">
                                <span>Horas Extras:</span>
                                <span id="horasCalculadas">0h</span>
                            </div>
                            <div class="calculo-item">
                                <span>Valor Hora Extra:</span>
                                <span id="valorHoraExtra">R$ 0,00</span>
                            </div>
                            <div class="calculo-total">
                                <span>Total Horas Extras:</span>
                                <span id="valorTotalHorasExtras">R$ 0,00</span>
                            </div>
                        </div>

                        <div class="calculo-card">
                            <div class="calculo-titulo">DSR (Descanso Semanal Remunerado)</div>
                            <div class="calculo-item">
                                <span>Valor DSR:</span>
                                <span id="valorDSR">R$ 0,00</span>
                            </div>
                            <div class="calculo-item">
                                <span>Fórmula:</span>
                                <span style="font-size: 12px;">(HE / Dias Úteis) × Dias Trabalhados</span>
                            </div>
                            <div class="calculo-total">
                                <span>Total Geral:</span>
                                <span id="valorTotalGeral" style="font-size: 24px; font-weight: bold; color: #27ae60;">R$ 0,00</span>
                            </div>
                        </div>
                    </div>

                    <button class="btn" onclick="registrarHoras()" style="margin-top: 20px;">💾 Registrar no Histórico</button>
                </div>
            </div>

            <!-- Tela de Comparação de Preços -->
            <div id="comparacaoScreen" class="screen">
                <h3 style="margin-bottom: 15px; color: #58595B;">💰 Comparação de Preços</h3>
                <p style="margin-bottom: 15px; color: #58595B; font-size: 14px;">
                    Comparação automática entre Mercado Livre e Shopee com Web Scraping
                </p>

                <div class="api-status">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Sistema de produtos interno</span>
                </div>

                <!-- Status do Monitoramento Automático -->
                <div class="auto-update-status" id="autoUpdateStatus" style="display: none;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <div class="status-dot loading" id="monitoramentoDot"></div>
                        <span id="monitoramentoText">Monitoramento automático ativo</span>
                    </div>
                    <div style="margin-top: 10px; font-size: 12px;">
                        Próxima atualização em: <span id="proximaAtualizacao">--:--</span>
                    </div>
                </div>

                <!-- Status do Scraping -->
                <div id="scrapingStatus" class="scraping-status" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="status-dot loading" id="scrapingDot"></div>
                        <span id="scrapingText">Iniciando web scraping...</span>
                    </div>
                </div>

                <!-- AÇÃO RÁPIDA -->
                <div class="action-buttons">
                    <button class="btn btn-cadastrar" onclick="mostrarTela('cadastroScreen')">
                        ➕ Cadastrar Produto
                    </button>
                    <button class="btn btn-lista-produtos" onclick="toggleListaProdutos()" id="btnListaProdutos">
                        📋 Lista de Produtos
                    </button>
                    <button class="btn btn-atualizar" onclick="atualizarPrecosAutomaticamente()">
                        🔄 Atualizar Preços
                    </button>
                    <button class="btn btn-monitoramento" onclick="toggleMonitoramentoAutomatico()" id="btnMonitoramento">
                        ⚡ Iniciar Monitoramento
                    </button>
                    <button class="btn btn-excel" onclick="exportarParaExcel()" id="btnExportarExcel">
                        📊 Exportar Excel
                    </button>
                </div>

                <!-- LISTA RÁPIDA DE PRODUTOS -->
                <div id="listaRapidaProdutos" class="lista-rapida-produtos" style="display: none;">
                    <h4 style="margin-bottom: 15px; color: #58595B;">📦 Produtos Cadastrados</h4>
                    <div id="conteudoListaRapida"></div>
                </div>

                <div class="filtros-container">
                    <div class="form-group">
                        <label for="filtroPlataforma">Plataforma:</label>
                        <select id="filtroPlataforma" onchange="filtrarProdutos()">
                            <option value="todos">Todas</option>
                            <option value="Mercado Livre">Mercado Livre</option>
                            <option value="Shopee">Shopee</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="filtroStatus">Status:</label>
                        <select id="filtroStatus" onchange="filtrarProdutos()">
                            <option value="todos">Todos</option>
                            <option value="ativo">Ativos</option>
                            <option value="inativo">Inativos</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="filtroMelhorPreco">Melhor Preço:</label>
                        <select id="filtroMelhorPreco" onchange="filtrarProdutos()">
                            <option value="todos">Todos</option>
                            <option value="ml">ML Mais Barato</option>
                            <option value="shopee">Shopee Mais Barato</option>
                        </select>
                    </div>
                </div>

                <div id="resumoComparacao" class="resumo-comparacao" style="display: none;">
                    <h4 style="margin-bottom: 15px;">📈 Resumo da Comparação</h4>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalProdutos">0</div>
                            <div class="stat-label">Total de Produtos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="mlMaisBarato">0</div>
                            <div class="stat-label">ML Mais Barato</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="shopeeMaisBarato">0</div>
                            <div class="stat-label">Shopee Mais Barato</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="empatePrecos">0</div>
                            <div class="stat-label">Empate de Preços</div>
                        </div>
                    </div>
                </div>

                <div id="contadorProdutos" class="contador-produtos">
                    📊 Sistema de produtos interno - Cadastre produtos para começar
                </div>

                <div id="comparacaoContainer" class="comparacao-container">
                    <div class="info-card">
                        <p>Nenhum produto cadastrado ainda.</p>
                        <p><small>Clique em "Cadastrar Produto" para adicionar produtos ao sistema.</small></p>
                    </div>
                </div>

                <!-- Histórico de Preços -->
                <div id="historicoPrecos" class="historico-precos" style="display: none;">
                    <h4 style="margin-bottom: 15px; color: #58595B;">📈 Histórico de Preços</h4>
                    <div id="listaHistoricoPrecos"></div>
                </div>

                <button class="btn btn-secondary" onclick="mostrarTela('menuScreen')">← Voltar ao Menu</button>
            </div>

            <!-- Tela de Cadastro de Produtos -->
            <div id="cadastroScreen" class="screen">
                <h3 style="margin-bottom: 20px; color: #58595B;">➕ Cadastrar Produto</h3>
                
                <div class="form-group">
                    <label for="nomeProduto">Nome do Produto:</label>
                    <input type="text" id="nomeProduto" placeholder="Ex: Gancheira Mosso Odyssey Challenger">
                </div>

                <div class="form-group">
                    <label for="skuProduto">SKU/Código:</label>
                    <input type="text" id="skuProduto" placeholder="Ex: K33009">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="mlbProduto">MLB (Mercado Livre):</label>
                        <input type="text" id="mlbProduto" placeholder="Ex: MLB2106981701">
                        <small style="color: #666;">O preço será buscado automaticamente via API</small>
                    </div>

                    <div class="form-group">
                        <label for="urlShopee">URL Shopee:</label>
                        <input type="text" id="urlShopee" placeholder="Ex: https://shopee.com.br/produto">
                        <small style="color: #666;">O preço será buscado automaticamente via Web Scraping</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="statusProduto">Status do Produto:</label>
                    <select id="statusProduto">
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                    </select>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-cadastrar" onclick="cadastrarProduto()">
                        💾 Salvar Produto
                    </button>
                    <button class="btn btn-secondary" onclick="mostrarTela('comparacaoScreen')">
                        ← Voltar
                    </button>
                </div>

                <div id="listaProdutosCadastrados" style="margin-top: 30px;">
                    <h4 style="margin-bottom: 15px; color: #58595B;">📋 Produtos Cadastrados</h4>
                    <div id="produtosCadastradosContainer"></div>
                </div>

                <!-- Histórico do Produto Selecionado -->
                <div id="historicoProduto" style="margin-top: 30px; display: none;">
                    <h4 style="margin-bottom: 15px; color: #58595B;">📊 Histórico de Preços do Produto</h4>
                    <div id="detalhesHistoricoProduto"></div>
                </div>
            </div>

            <!-- Telas de Histórico e Resumo -->
            <div id="historicoScreen" class="screen">
                <h3 style="margin-bottom: 20px; color: #58595B;">📋 Meu Histórico</h3>
                <div id="listaHistorico"></div>
                <button class="btn btn-secondary" onclick="mostrarTela('menuScreen')" style="margin-top: 20px;">Voltar</button>
            </div>

            <div id="resumoScreen" class="screen">
                <h3 style="margin-bottom: 20px; color: #58595B;">ℹ️ Meu Resumo</h3>
                <div id="dadosResumo"></div>
                <button class="btn btn-secondary" onclick="mostrarTela('menuScreen')" style="margin-top: 20px;">Voltar</button>
            </div>
        </div>
    </div>

    <script>
        // Dados dos funcionários
        const funcionarios = {
            "2209": {"nome": "Andressa Sloboda", "salario": 2223.90, "acessoAnuncios": true},
            "1809": {"nome": "Adryel Silva", "salario": 1098.48, "acessoAnuncios": false},
            "3003": {"nome": "Arthur Finkler", "salario": 2557.50, "acessoAnuncios": true},
            "0408": {"nome": "Bruna Jomek", "salario": 2223.90, "acessoAnuncios": true},
            "2411": {"nome": "Elaine Guidelli", "salario": 2640.00, "acessoAnuncios": false},
            "2701": {"nome": "Laura Souza", "salario": 2100.00, "acessoAnuncios": false},
            "1204": {"nome": "Thalyta Pampuch", "salario": 2223.90, "acessoAnuncios": true}
        };

        // 🔧 CONFIGURAÇÕES DO MERCADO LIVRE
        const ML_CONFIG = {
            app_key: '6382303492960193',
            access_token: 'APP_USR-6382303492960193-102410-577704e0d4d1ffc1957af5e23f94bf26-415176739',
            client_secret: 'J0eBOOjqAG60c1jiXZd0J9YXp76r5EPe'
        };

        // ⚙️ CONFIGURAÇÕES DE WEB SCRAPING
        const SCRAPING_CONFIG = {
            delayEntreRequisicoes: 2000,
            timeout: 15000,
            maxTentativas: 2,
            userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
        };

        let funcionarioLogado = null;
        let historico = JSON.parse(localStorage.getItem('historicoHorasExtras')) || {};
        let todosProdutos = JSON.parse(localStorage.getItem('produtosCadastrados')) || [];
        let monitoramentoAtivo = false;
        let intervaloMonitoramento = null;
        const INTERVALO_ATUALIZACAO = 6 * 60 * 60 * 1000;
        let produtoEditandoId = null;

        // 🔑 FUNÇÃO: Login ATUALIZADA
        function fazerLogin() {
            const senha = document.getElementById('senha').value.trim();
            
            if (!senha) {
                alert('❌ Por favor, digite sua senha!');
                return;
            }

            if (funcionarios[senha]) {
                funcionarioLogado = {
                    senha: senha,
                    ...funcionarios[senha]
                };
                
                document.getElementById('nomeFuncionario').textContent = funcionarioLogado.nome;
                
                const acessoAnunciosDiv = document.getElementById('acessoAnuncios');
                const secaoAdministrativo = document.getElementById('secaoAdministrativo');
                
                if (funcionarioLogado.acessoAnuncios) {
                    acessoAnunciosDiv.style.display = 'block';
                    secaoAdministrativo.style.display = 'block';
                } else {
                    acessoAnunciosDiv.style.display = 'none';
                    secaoAdministrativo.style.display = 'none';
                }
                
                mostrarTela('menuScreen');
                document.getElementById('senha').value = '';
                
            } else {
                alert('❌ Senha inválida! Tente: 2209, 1809, 3003, 0408, 2411, 2701, 1204');
            }
        }

        // 🧭 FUNÇÃO: Mostrar comparação de preços
        function mostrarComparacaoPrecos() {
            if (!funcionarioLogado.acessoAnuncios) {
                alert('❌ Acesso não autorizado!');
                return;
            }
            mostrarTela('comparacaoScreen');
        }

        // ... (TODAS AS OUTRAS FUNÇÕES PERMANECEM EXATAMENTE IGUAIS) ...

        // 🚀 FUNÇÃO: Atualizar preços automaticamente
        async function atualizarPrecosAutomaticamente() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const scrapingDiv = document.getElementById('scrapingStatus');
            const scrapingText = document.getElementById('scrapingText');
            
            statusDot.className = 'status-dot loading';
            statusText.textContent = 'Iniciando atualização de preços...';
            scrapingDiv.style.display = 'block';
            scrapingText.textContent = 'Preparando web scraping...';

            try {
                let produtosAtualizados = 0;
                let produtosComErro = 0;

                for (let i = 0; i < todosProdutos.length; i++) {
                    const produto = todosProdutos[i];
                    
                    // Atualizar status em tempo real
                    statusText.textContent = `Atualizando ${i + 1}/${todosProdutos.length}`;
                    scrapingText.textContent = `Processando: ${produto.nome}`;
                    
                    let precoAtualizado = false;

                    // Buscar preço do Mercado Livre
                    if (produto.mlb && produto.mlb.trim() !== '') {
                        try {
                            scrapingText.textContent = `Buscando ML: ${produto.nome}`;
                            const precoML = await buscarPrecoMercadoLivre(produto.mlb);
                            if (precoML && precoML !== produto.precoML) {
                                produto.precoML = precoML;
                                precoAtualizado = true;
                                console.log(`✅ ML atualizado: ${produto.nome} - R$ ${precoML}`);
                            }
                        } catch (error) {
                            console.error(`❌ Erro ML ${produto.nome}:`, error);
                            produtosComErro++;
                        }
                    }

                    // Buscar preço da Shopee
                    if (produto.urlShopee && produto.urlShopee.trim() !== '') {
                        try {
                            scrapingText.textContent = `Scraping Shopee: ${produto.nome}`;
                            const precoShopee = await buscarPrecoShopee(produto.urlShopee);
                            if (precoShopee && precoShopee !== produto.precoShopee) {
                                produto.precoShopee = precoShopee;
                                precoAtualizado = true;
                                console.log(`✅ Shopee atualizado: ${produto.nome} - R$ ${precoShopee}`);
                            }
                        } catch (error) {
                            console.error(`❌ Erro Shopee ${produto.nome}:`, error);
                            produtosComErro++;
                        }
                    }

                    if (precoAtualizado) {
                        produtosAtualizados++;
                        registrarMudancaPreco(produto);
                    }

                    // Delay entre requisições
                    await new Promise(resolve => setTimeout(resolve, SCRAPING_CONFIG.delayEntreRequisicoes));
                }

                localStorage.setItem('produtosCadastrados', JSON.stringify(todosProdutos));
                
                statusDot.className = 'status-dot';
                scrapingDiv.style.display = 'none';
                
                if (produtosAtualizados > 0) {
                    statusText.textContent = `✅ ${produtosAtualizados} preços atualizados`;
                    if (produtosComErro > 0) {
                        statusText.textContent += ` | ${produtosComErro} erros`;
                    }
                } else {
                    statusText.textContent = `ℹ️ Nenhum preço novo encontrado`;
                    if (produtosComErro > 0) {
                        statusText.textContent += ` | ${produtosComErro} erros`;
                    }
                }
                
                carregarProdutosInternos();
                
            } catch (error) {
                statusDot.className = 'status-dot error';
                statusText.textContent = '❌ Erro na atualização';
                document.getElementById('scrapingStatus').style.display = 'none';
                console.error('Erro geral na atualização:', error);
            }
        }

        // 🔍 FUNÇÃO: Buscar preço do Mercado Livre
        async function buscarPrecoMercadoLivre(mlb) {
            if (ML_CONFIG.app_key === 'SUA_APP_KEY_AQUI' || ML_CONFIG.access_token === 'SEU_ACCESS_TOKEN_AQUI') {
                throw new Error('Credenciais do ML não configuradas');
            }

            try {
                const response = await fetch(`https://api.mercadolibre.com/items/${mlb}?access_token=${ML_CONFIG.access_token}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.price && typeof data.price === 'number') {
                    return data.price;
                } else {
                    throw new Error('Preço não encontrado');
                }
                
            } catch (error) {
                console.error(`Erro ao buscar MLB ${mlb}:`, error);
                throw error;
            }
        }

        // 🛍️ FUNÇÃO: Buscar preço real da Shopee via Web Scraping
        async function buscarPrecoShopeeReal(urlShopee) {
            try {
                console.log(`🔍 Iniciando scraping para: ${urlShopee}`);
                
                // Usando proxy CORS para contornar restrições
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const targetUrl = urlShopee;
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), SCRAPING_CONFIG.timeout);

                const response = await fetch(proxyUrl + targetUrl, {
                    method: 'GET',
                    headers: {
                        'User-Agent': SCRAPING_CONFIG.userAgent,
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
                        'Accept-Language': 'pt-BR,pt;q=0.9,en;q=0.8',
                    },
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const html = await response.text();
                
                // Extrair preço usando diferentes padrões
                let preco = extrairPrecoDoHTML(html);
                
                if (preco) {
                    console.log(`✅ Preço Shopee encontrado: R$ ${preco}`);
                    return preco;
                } else {
                    throw new Error('Preço não encontrado no HTML');
                }
                
            } catch (error) {
                console.error('❌ Erro no scraping Shopee:', error);
                throw error;
            }
        }

        // 🔍 FUNÇÃO: Extrair preço do HTML da Shopee
        function extrairPrecoDoHTML(html) {
            const padroesPreco = [
                /"price":\s*(\d+)/g,
                /"price":\s*"(\d+)"/g,
                /"item_price":\s*(\d+)/g,
                /"item_price":\s*"(\d+)"/g,
                /"final_price":\s*(\d+)/g,
                /"final_price":\s*"(\d+)"/g,
                /<span[^>]*class="[^"]*price[^"]*"[^>]*>[\s\S]*?R\$\s*([\d.,]+)/gi,
                /<div[^>]*class="[^"]*price[^"]*"[^>]*>[\s\S]*?R\$\s*([\d.,]+)/gi,
                /data-price="(\d+)"/g,
                /"value":\s*"(\d+)"/g
            ];

            for (let padrao of padroesPreco) {
                const matches = html.match(padrao);
                if (matches) {
                    for (let match of matches) {
                        const precoMatch = match.match(/(\d+)/);
                        if (precoMatch && precoMatch[1]) {
                            const preco = parseInt(precoMatch[1]) / 100;
                            if (preco > 1 && preco < 100000) {
                                return preco;
                            }
                        }
                    }
                }
            }
            
            return null;
        }

        // 🔄 FUNÇÃO: Buscar preço da Shopee (VERSÃO COMPLETA)
        async function buscarPrecoShopee(urlShopee) {
            if (!urlShopee || !urlShopee.includes('shopee')) {
                return null;
            }

            console.log(`🛍️ Buscando preço Shopee: ${urlShopee}`);

            // Tentar web scraping primeiro
            try {
                const preco = await buscarPrecoShopeeReal(urlShopee);
                if (preco && preco > 0) {
                    return preco;
                }
            } catch (error) {
                console.warn('Web scraping falhou:', error.message);
            }

            // Fallback: simulação
            console.log('🔄 Usando fallback simulado para Shopee');
            return await buscarPrecoShopeeSimulado(urlShopee);
        }

        // 🎲 FUNÇÃO: Simulação de preço (fallback)
        async function buscarPrecoShopeeSimulado(urlShopee) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    let precoBase = 200;
                    
                    if (urlShopee.includes('gancheira') || urlShopee.includes('cannondale')) {
                        precoBase = 250 + Math.random() * 150;
                    } else if (urlShopee.includes('bicicleta') || urlShopee.includes('aro')) {
                        precoBase = 800 + Math.random() * 500;
                    } else if (urlShopee.includes('capacete') || urlShopee.includes('proteção')) {
                        precoBase = 80 + Math.random() * 70;
                    } else {
                        precoBase = 150 + Math.random() * 200;
                    }
                    
                    resolve(parseFloat(precoBase.toFixed(2)));
                }, 2000);
            });
        }

        // 💾 FUNÇÃO: Registrar mudança de preço no histórico
        function registrarMudancaPreco(produto) {
            let historicoPrecos = JSON.parse(localStorage.getItem('historicoPrecos')) || {};
            
            if (!historicoPrecos[produto.id]) {
                historicoPrecos[produto.id] = [];
            }
            
            const registro = {
                timestamp: new Date().toISOString(),
                data: new Date().toLocaleString('pt-BR'),
                precoML: produto.precoML,
                precoShopee: produto.precoShopee,
                diferenca: produto.precoShopee - produto.precoML
            };
            
            historicoPrecos[produto.id].push(registro);
            
            if (historicoPrecos[produto.id].length > 100) {
                historicoPrecos[produto.id] = historicoPrecos[produto.id].slice(-100);
            }
            
            localStorage.setItem('historicoPrecos', JSON.stringify(historicoPrecos));
        }

        // 📊 FUNÇÃO: Exportar para Excel
        function exportarParaExcel() {
            if (todosProdutos.length === 0) {
                alert('❌ Nenhum produto cadastrado para exportar!');
                return;
            }

            let csv = 'Nome do Produto,SKU,MLB,Preço Mercado Livre,URL Shopee,Preço Shopee,Status,Data Cadastro,Diferença,Melhor Preço\n';
            
            todosProdutos.forEach(produto => {
                const diferenca = produto.precoShopee - produto.precoML;
                const melhorPreco = diferenca < 0 ? 'Mercado Livre' : diferenca > 0 ? 'Shopee' : 'Empate';
                
                const linha = [
                    `"${produto.nome}"`,
                    `"${produto.sku}"`,
                    `"${produto.mlb || ''}"`,
                    produto.precoML > 0 ? produto.precoML.toFixed(2) : '0.00',
                    `"${produto.urlShopee || ''}"`,
                    produto.precoShopee > 0 ? produto.precoShopee.toFixed(2) : '0.00',
                    `"${produto.status}"`,
                    `"${produto.dataCadastro}"`,
                    diferenca.toFixed(2),
                    `"${melhorPreco}"`
                ].join(',');
                
                csv += linha + '\n';
            });

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `produtos_wheel_tech_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`✅ ${todosProdutos.length} produtos exportados com sucesso!`);
        }

        // 📋 FUNÇÃO: Toggle da lista rápida de produtos
        function toggleListaProdutos() {
            const listaDiv = document.getElementById('listaRapidaProdutos');
            const btnLista = document.getElementById('btnListaProdutos');
            
            if (listaDiv.style.display === 'none') {
                carregarListaRapidaProdutos();
                listaDiv.style.display = 'block';
                btnLista.innerHTML = '📋 Ocultar Lista';
                btnLista.style.background = 'linear-gradient(135deg, #58595B 0%, #808080 100%)';
            } else {
                listaDiv.style.display = 'none';
                btnLista.innerHTML = '📋 Lista de Produtos';
                btnLista.style.background = 'linear-gradient(135deg, #FF6B35 0%, #F7931E 100%)';
            }
        }

        // 📦 FUNÇÃO: Carregar lista rápida de produtos
        function carregarListaRapidaProdutos() {
            const container = document.getElementById('conteudoListaRapida');
            
            if (todosProdutos.length === 0) {
                container.innerHTML = '<div class="info-card"><p>Nenhum produto cadastrado ainda.</p></div>';
                return;
            }

            container.innerHTML = todosProdutos.map(produto => `
                <div class="produto-item-rapido">
                    <div class="produto-info-rapido">
                        <div class="produto-nome-rapido">${produto.nome}</div>
                        <div class="produto-sku-rapido">SKU: ${produto.sku} | MLB: ${produto.mlb || 'Não informado'}</div>
                        <div class="preco-info">
                            <span class="${produto.precoML > 0 ? 'preco-carregado' : 'preco-pendente'}">
                                ML: ${produto.precoML > 0 ? `R$ ${produto.precoML.toFixed(2)}` : 'Não carregado'}
                            </span> | 
                            <span class="${produto.precoShopee > 0 ? 'preco-carregado' : 'preco-pendente'}">
                                Shopee: ${produto.precoShopee > 0 ? `R$ ${produto.precoShopee.toFixed(2)}` : 'Não carregado'}
                            </span>
                        </div>
                    </div>
                    <div class="produto-acoes-rapido">
                        <button class="btn btn-pequeno" onclick="mostrarHistoricoProduto(${produto.id})" title="Ver histórico">
                            📊
                        </button>
                        <button class="btn btn-pequeno" onclick="editarProduto(${produto.id})" title="Editar produto">
                            ✏️
                        </button>
                        <button class="btn btn-pequeno" onclick="excluirProduto(${produto.id})" title="Excluir produto">
                            🗑️
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ✏️ FUNÇÃO: Editar produto
        function editarProduto(id) {
            const produto = todosProdutos.find(p => p.id === id);
            if (!produto) return;

            produtoEditandoId = produto.id;
            
            document.getElementById('nomeProduto').value = produto.nome;
            document.getElementById('skuProduto').value = produto.sku;
            document.getElementById('mlbProduto').value = produto.mlb || '';
            document.getElementById('urlShopee').value = produto.urlShopee || '';
            document.getElementById('statusProduto').value = produto.status;

            mostrarTela('cadastroScreen');
            window.scrollTo(0, 0);

            setTimeout(() => {
                alert(`Editando: ${produto.nome}\n\nAltere os dados e clique em "Salvar Produto" para atualizar.`);
            }, 500);
        }

        // ➕ FUNÇÃO: Cadastrar produto
        function cadastrarProduto() {
            const nome = document.getElementById('nomeProduto').value.trim();
            const sku = document.getElementById('skuProduto').value.trim();
            const mlb = document.getElementById('mlbProduto').value.trim();
            const urlShopee = document.getElementById('urlShopee').value.trim();
            const status = document.getElementById('statusProduto').value;

            if (!nome) {
                alert('❌ Por favor, informe o nome do produto!');
                return;
            }

            if (!sku) {
                alert('❌ Por favor, informe o SKU do produto!');
                return;
            }

            let produtoAtualizado;

            if (produtoEditandoId) {
                produtoAtualizado = {
                    ...todosProdutos.find(p => p.id === produtoEditandoId),
                    nome: nome,
                    sku: sku,
                    mlb: mlb,
                    urlShopee: urlShopee,
                    status: status
                };

                todosProdutos = todosProdutos.map(p => p.id === produtoEditandoId ? produtoAtualizado : p);
                
            } else {
                const produtoExistente = todosProdutos.find(p => p.sku === sku);
                if (produtoExistente) {
                    alert('❌ Já existe um produto com este SKU!');
                    return;
                }

                produtoAtualizado = {
                    id: Date.now(),
                    nome: nome,
                    sku: sku,
                    mlb: mlb,
                    precoML: 0,
                    urlShopee: urlShopee,
                    precoShopee: 0,
                    status: status,
                    dataCadastro: new Date().toLocaleString('pt-BR')
                };

                todosProdutos.push(produtoAtualizado);
            }

            localStorage.setItem('produtosCadastrados', JSON.stringify(todosProdutos));

            document.getElementById('nomeProduto').value = '';
            document.getElementById('skuProduto').value = '';
            document.getElementById('mlbProduto').value = '';
            document.getElementById('urlShopee').value = '';
            document.getElementById('statusProduto').value = 'ativo';
            
            produtoEditandoId = null;

            alert(`✅ Produto ${produtoEditandoId ? 'atualizado' : 'cadastrado'} com sucesso!`);
            
            atualizarListaProdutosCadastrados();
            if (document.getElementById('listaRapidaProdutos').style.display === 'block') {
                carregarListaRapidaProdutos();
            }

            mostrarTela('comparacaoScreen');
        }

        // 🗑️ FUNÇÃO: Excluir produto
        function excluirProduto(id) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                todosProdutos = todosProdutos.filter(produto => produto.id !== id);
                localStorage.setItem('produtosCadastrados', JSON.stringify(todosProdutos));
                if (document.getElementById('listaRapidaProdutos').style.display === 'block') {
                    carregarListaRapidaProdutos();
                }
                alert('✅ Produto excluído com sucesso!');
            }
        }

        // 📋 FUNÇÃO: Atualizar lista de produtos cadastrados
        function atualizarListaProdutosCadastrados() {
            const container = document.getElementById('produtosCadastradosContainer');
            
            if (todosProdutos.length === 0) {
                container.innerHTML = '<div class="info-card"><p>Nenhum produto cadastrado ainda.</p></div>';
                return;
            }

            container.innerHTML = todosProdutos.map(produto => `
                <div class="produto-card" style="margin-bottom: 10px;">
                    <div class="produto-header">
                        <div class="produto-titulo">${produto.nome}</div>
                        <div class="produto-sku">${produto.sku}</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div>
                            <strong>Mercado Livre:</strong><br>
                            ${produto.mlb ? `MLB: ${produto.mlb}<br>` : ''}
                            ${produto.precoML > 0 ? `R$ ${produto.precoML.toFixed(2)}` : 'Preço não carregado'}
                        </div>
                        <div>
                            <strong>Shopee:</strong><br>
                            ${produto.urlShopee ? `URL: ${produto.urlShopee.substring(0, 30)}...<br>` : ''}
                            ${produto.precoShopee > 0 ? `R$ ${produto.precoShopee.toFixed(2)}` : 'Preço não carregado'}
                        </div>
                    </div>
                    <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <span class="status-produto status-${produto.status}">${produto.status}</span>
                        <div>
                            <button class="btn btn-pequeno" onclick="mostrarHistoricoProduto(${produto.id})" style="margin-right: 5px;">
                                📊 Histórico
                            </button>
                            <button class="btn btn-pequeno" onclick="editarProduto(${produto.id})" style="margin-right: 5px;">
                                ✏️ Editar
                            </button>
                            <button class="btn btn-pequeno" onclick="excluirProduto(${produto.id})">
                                🗑️ Excluir
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 🚀 FUNÇÃO: Carregar produtos do sistema interno
        function carregarProdutosInternos() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const container = document.getElementById('comparacaoContainer');
            const contador = document.getElementById('contadorProdutos');

            statusDot.className = 'status-dot loading';
            statusText.textContent = 'Carregando produtos...';
            container.innerHTML = '';
            contador.textContent = '📊 Carregando...';

            setTimeout(() => {
                statusDot.className = 'status-dot';
                
                if (todosProdutos.length > 0) {
                    const produtosComPrecoML = todosProdutos.filter(p => p.precoML > 0).length;
                    const produtosComPrecoShopee = todosProdutos.filter(p => p.precoShopee > 0).length;
                    
                    statusText.textContent = `✅ ${todosProdutos.length} produtos carregados`;
                    contador.textContent = `📊 ${todosProdutos.length} produtos | ML: ${produtosComPrecoML} | Shopee: ${produtosComPrecoShopee}`;
                    
                    filtrarProdutos();
                    atualizarResumoComparacao();
                    
                    mostrarHistoricoPrecos();

                    if (document.getElementById('listaRapidaProdutos').style.display === 'block') {
                        carregarListaRapidaProdutos();
                    }
                } else {
                    statusText.textContent = 'ℹ️ Nenhum produto cadastrado';
                    container.innerHTML = `
                        <div class="info-card">
                            <p>Nenhum produto cadastrado ainda.</p>
                            <p><small>Clique em "Cadastrar Produto" para adicionar produtos ao sistema.</small></p>
                        </div>
                    `;
                    contador.textContent = '📊 Nenhum produto cadastrado';
                }
            }, 800);
        }

        // 📊 FUNÇÃO: Filtrar produtos
        function filtrarProdutos() {
            const filtroPlataforma = document.getElementById('filtroPlataforma').value;
            const filtroStatus = document.getElementById('filtroStatus').value;
            const filtroMelhorPreco = document.getElementById('filtroMelhorPreco').value;
            const container = document.getElementById('comparacaoContainer');
            const contador = document.getElementById('contadorProdutos');

            let produtosFiltrados = todosProdutos.filter(produto => {
                const temML = produto.precoML > 0;
                const temShopee = produto.precoShopee > 0;
                let plataformaMatch = true;
                
                if (filtroPlataforma === 'Mercado Livre') plataformaMatch = temML;
                if (filtroPlataforma === 'Shopee') plataformaMatch = temShopee;

                let statusMatch = true;
                if (filtroStatus === 'ativo') statusMatch = produto.status === 'ativo';
                if (filtroStatus === 'inativo') statusMatch = produto.status === 'inativo';

                let precoMatch = true;
                if (filtroMelhorPreco === 'ml') {
                    precoMatch = produto.precoML > 0 && produto.precoShopee > 0 && produto.precoML < produto.precoShopee;
                } else if (filtroMelhorPreco === 'shopee') {
                    precoMatch = produto.precoML > 0 && produto.precoShopee > 0 && produto.precoShopee < produto.precoML;
                }

                return plataformaMatch && statusMatch && precoMatch;
            });

            contador.textContent = `📊 Mostrando ${produtosFiltrados.length} de ${todosProdutos.length} produtos`;

            if (produtosFiltrados.length === 0) {
                container.innerHTML = '<div class="info-card"><p>Nenhum produto encontrado com os filtros selecionados.</p></div>';
                return;
            }

            container.innerHTML = produtosFiltrados.map(produto => {
                const diferenca = produto.precoShopee - produto.precoML;
                
                return `
                    <div class="produto-card">
                        <div class="produto-header">
                            <div class="produto-titulo">${produto.nome}</div>
                            <div class="produto-sku">${produto.sku}</div>
                        </div>
                        
                        <div class="precos-comparacao">
                            <div class="preco-plataforma preco-ml">
                                <div class="plataforma-nome">🛒 Mercado Livre</div>
                                ${produto.precoML > 0 ? `
                                    <div class="preco-valor">R$ ${produto.precoML.toFixed(2)}</div>
                                    <div class="status-produto status-${produto.status}">${produto.status}</div>
                                    ${produto.mlb ? `<div style="font-size: 12px; color: #666;">MLB: ${produto.mlb}</div>` : ''}
                                    ${diferenca < 0 ? `<div class="diferenca diferenca-positiva">+R$ ${Math.abs(diferenca).toFixed(2)} mais barato</div>` : ''}
                                ` : '<div style="color: #888; padding: 10px;">Preço não carregado</div>'}
                            </div>
                            
                            <div class="preco-plataforma preco-shopee">
                                <div class="plataforma-nome">🛍️ Shopee</div>
                                ${produto.precoShopee > 0 ? `
                                    <div class="preco-valor">R$ ${produto.precoShopee.toFixed(2)}</div>
                                    <div class="status-produto status-${produto.status}">${produto.status}</div>
                                    ${produto.urlShopee ? `<div style="font-size: 12px; color: #666;">URL: ${produto.urlShopee.substring(0, 20)}...</div>` : ''}
                                    ${diferenca > 0 ? `<div class="diferenca diferenca-positiva">+R$ ${diferenca.toFixed(2)} mais barato</div>` : ''}
                                ` : '<div style="color: #888; padding: 10px;">Preço não carregado</div>'}
                            </div>
                        </div>
                        
                        ${produto.precoML > 0 && produto.precoShopee > 0 ? `
                            <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666;">
                                💰 Diferença: R$ ${Math.abs(diferenca).toFixed(2)} | 
                                ${diferenca < 0 ? '🛒 ML mais barato' : diferenca > 0 ? '🛍️ Shopee mais barato' : '⚖️ Mesmo preço'}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // 📈 FUNÇÃO: Atualizar resumo da comparação
        function atualizarResumoComparacao() {
            const resumo = document.getElementById('resumoComparacao');
            const totalProdutos = document.getElementById('totalProdutos');
            const mlMaisBarato = document.getElementById('mlMaisBarato');
            const shopeeMaisBarato = document.getElementById('shopeeMaisBarato');
            const empatePrecos = document.getElementById('empatePrecos');

            let mlBaratoCount = 0;
            let shopeeBaratoCount = 0;
            let empateCount = 0;

            todosProdutos.forEach(produto => {
                if (produto.precoML > 0 && produto.precoShopee > 0) {
                    const diferenca = produto.precoShopee - produto.precoML;
                    if (diferenca < 0) mlBaratoCount++;
                    else if (diferenca > 0) shopeeBaratoCount++;
                    else empateCount++;
                }
            });

            totalProdutos.textContent = `${todosProdutos.length}`;
            mlMaisBarato.textContent = `${mlBaratoCount}`;
            shopeeMaisBarato.textContent = `${shopeeBaratoCount}`;
            empatePrecos.textContent = `${empateCount}`;

            resumo.style.display = todosProdutos.length > 0 ? 'block' : 'none';
        }

        // ⚡ FUNÇÃO: Toggle monitoramento automático
        function toggleMonitoramentoAutomatico() {
            const btnMonitoramento = document.getElementById('btnMonitoramento');
            const statusDiv = document.getElementById('autoUpdateStatus');
            
            if (!monitoramentoAtivo) {
                monitoramentoAtivo = true;
                btnMonitoramento.innerHTML = '⏸️ Pausar Monitoramento';
                btnMonitoramento.style.background = 'linear-gradient(135deg, #FF6B35 0%, #F7931E 100%)';
                statusDiv.style.display = 'block';
                
                atualizarPrecosAutomaticamente();
                intervaloMonitoramento = setInterval(atualizarPrecosAutomaticamente, INTERVALO_ATUALIZACAO);
                atualizarProximaAtualizacao();
                
            } else {
                monitoramentoAtivo = false;
                btnMonitoramento.innerHTML = '⚡ Iniciar Monitoramento';
                btnMonitoramento.style.background = 'linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%)';
                statusDiv.style.display = 'none';
                
                if (intervaloMonitoramento) {
                    clearInterval(intervaloMonitoramento);
                }
            }
        }

        // 🕒 FUNÇÃO: Atualizar próxima atualização
        function atualizarProximaAtualizacao() {
            const elemento = document.getElementById('proximaAtualizacao');
            if (elemento && monitoramentoAtivo) {
                const agora = new Date();
                const proxima = new Date(agora.getTime() + INTERVALO_ATUALIZACAO);
                elemento.textContent = proxima.toLocaleTimeString('pt-BR');
            }
        }

        // 📊 FUNÇÃO: Mostrar histórico de preços
        function mostrarHistoricoPrecos() {
            const historicoDiv = document.getElementById('historicoPrecos');
            const listaDiv = document.getElementById('listaHistoricoPrecos');
            
            const historicoGeral = JSON.parse(localStorage.getItem('historicoGeralPrecos')) || [];
            
            if (historicoGeral.length === 0) {
                listaDiv.innerHTML = '<div class="info-card"><p>Nenhum histórico de preços disponível.</p></div>';
            } else {
                listaDiv.innerHTML = historicoGeral.slice().reverse().map(registro => {
                    const data = new Date(registro.dataAtualizacao).toLocaleString('pt-BR');
                    
                    return `
                        <div class="historico-item">
                            <div class="historico-header">
                                <span>📅 ${data}</span>
                                <span>${registro.produtos.length} produtos</span>
                            </div>
                            <div class="historico-detalhes">
                                ${registro.produtos.slice(0, 3).map(produto => `
                                    <div>
                                        <strong>${produto.nome}</strong><br>
                                        ML: R$ ${produto.precoML.toFixed(2)}<br>
                                        Shopee: R$ ${produto.precoShopee.toFixed(2)}
                                    </div>
                                `).join('')}
                            </div>
                            ${registro.produtos.length > 3 ? 
                                `<div style="text-align: center; margin-top: 8px; font-size: 12px; color: #666;">
                                    +${registro.produtos.length - 3} produtos...
                                </div>` : ''}
                        </div>
                    `;
                }).join('');
            }
            
            historicoDiv.style.display = 'block';
        }

        // 🔍 FUNÇÃO: Mostrar histórico de um produto específico
        function mostrarHistoricoProduto(produtoId) {
            const historicoDiv = document.getElementById('historicoProduto');
            const detalhesDiv = document.getElementById('detalhesHistoricoProduto');
            
            const historicoPrecos = JSON.parse(localStorage.getItem('historicoPrecos')) || {};
            const historicoProduto = historicoPrecos[produtoId] || [];
            
            if (historicoProduto.length === 0) {
                detalhesDiv.innerHTML = '<div class="info-card"><p>Nenhum histórico disponível para este produto.</p></div>';
            } else {
                detalhesDiv.innerHTML = historicoProduto.slice().reverse().map((registro, index) => {
                    const variacaoML = index > 0 ? 
                        ((registro.precoML - historicoProduto[historicoProduto.length - index].precoML) / historicoProduto[historicoProduto.length - index].precoML * 100) : 0;
                    
                    const variacaoShopee = index > 0 ? 
                        ((registro.precoShopee - historicoProduto[historicoProduto.length - index].precoShopee) / historicoProduto[historicoProduto.length - index].precoShopee * 100) : 0;
                    
                    return `
                        <div class="historico-item">
                            <div class="historico-header">
                                <span>📅 ${registro.data}</span>
                                <span>Dif: R$ ${Math.abs(registro.diferenca).toFixed(2)}</span>
                            </div>
                            <div class="historico-detalhes">
                                <div>
                                    <strong>Mercado Livre</strong><br>
                                    R$ ${registro.precoML.toFixed(2)}<br>
                                    ${index > 0 ? `<span class="${variacaoML >= 0 ? 'variacao-positiva' : 'variacao-negativa'}">
                                        ${variacaoML >= 0 ? '↗' : '↘'} ${Math.abs(variacaoML).toFixed(1)}%
                                    </span>` : 'Primeiro registro'}
                                </div>
                                <div>
                                    <strong>Shopee</strong><br>
                                    R$ ${registro.precoShopee.toFixed(2)}<br>
                                    ${index > 0 ? `<span class="${variacaoShopee >= 0 ? 'variacao-positiva' : 'variacao-negativa'}">
                                        ${variacaoShopee >= 0 ? '↗' : '↘'} ${Math.abs(variacaoShopee).toFixed(1)}%
                                    </span>` : 'Primeiro registro'}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            historicoDiv.style.display = 'block';
        }

        // ⏰ FUNÇÃO: Calcular horas extras com DSR
        function calcularHorasExtras() {
            const horas = parseFloat(document.getElementById('horasExtras').value);
            const diasUteis = parseInt(document.getElementById('diasUteis').value);
            const diasTrabalhados = parseInt(document.getElementById('diasTrabalhados').value);
            
            if (!horas || horas <= 0) {
                alert('❌ Digite uma quantidade válida de horas!');
                return;
            }

            if (!diasUteis || diasUteis <= 0) {
                alert('❌ Digite uma quantidade válida de dias úteis!');
                return;
            }

            if (!diasTrabalhados || diasTrabalhados <= 0) {
                alert('❌ Digite uma quantidade válida de dias trabalhados!');
                return;
            }

            const valorHora = funcionarioLogado.salario / 220;
            const valorHoraExtra = valorHora * 1.5;
            const valorTotalHorasExtras = valorHoraExtra * horas;
            
            const valorDSR = (valorTotalHorasExtras / diasUteis) * diasTrabalhados;
            const valorTotalGeral = valorTotalHorasExtras + valorDSR;

            document.getElementById('horasCalculadas').textContent = `${horas}h`;
            document.getElementById('valorHoraExtra').textContent = `R$ ${valorHoraExtra.toFixed(2)}`;
            document.getElementById('valorTotalHorasExtras').textContent = `R$ ${valorTotalHorasExtras.toFixed(2)}`;
            document.getElementById('valorDSR').textContent = `R$ ${valorDSR.toFixed(2)}`;
            document.getElementById('valorTotalGeral').textContent = `R$ ${valorTotalGeral.toFixed(2)}`;
            
            document.getElementById('resultadoCalculo').style.display = 'block';

            sessionStorage.setItem('calculoTemp', JSON.stringify({
                horas: horas,
                diasUteis: diasUteis,
                diasTrabalhados: diasTrabalhados,
                valorTotalHorasExtras: valorTotalHorasExtras,
                valorDSR: valorDSR,
                valorTotalGeral: valorTotalGeral
            }));
        }

        // 💾 FUNÇÃO: Registrar horas no histórico
        function registrarHoras() {
            const calculoTemp = JSON.parse(sessionStorage.getItem('calculoTemp'));
            
            if (!calculoTemp) {
                alert('❌ Realize um cálculo primeiro!');
                return;
            }

            const registro = {
                data: new Date().toLocaleString('pt-BR'),
                horas: calculoTemp.horas,
                diasUteis: calculoTemp.diasUteis,
                diasTrabalhados: calculoTemp.diasTrabalhados,
                valorTotalHorasExtras: calculoTemp.valorTotalHorasExtras,
                valorDSR: calculoTemp.valorDSR,
                valorTotalGeral: calculoTemp.valorTotalGeral
            };

            if (!historico[funcionarioLogado.senha]) {
                historico[funcionarioLogado.senha] = [];
            }
            
            historico[funcionarioLogado.senha].push(registro);
            localStorage.setItem('historicoHorasExtras', JSON.stringify(historico));

            alert('✅ Horas extras registradas com sucesso!');
            sessionStorage.removeItem('calculoTemp');
            document.getElementById('resultadoCalculo').style.display = 'none';
            document.getElementById('horasExtras').value = '1';
            document.getElementById('diasUteis').value = '22';
            document.getElementById('diasTrabalhados').value = '20';
        }

        // 📋 FUNÇÃO: Mostrar histórico
        function mostrarHistorico() {
            const historicoDiv = document.getElementById('listaHistorico');
            const historicoFuncionario = historico[funcionarioLogado.senha] || [];

            if (historicoFuncionario.length === 0) {
                historicoDiv.innerHTML = '<div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;"><p>Nenhuma hora extra registrada até o momento.</p></div>';
            } else {
                historicoDiv.innerHTML = historicoFuncionario.map((registro, index) => `
                    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong>Data:</strong>
                            <span>${registro.data}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong>Horas Extras:</strong>
                            <span>${registro.horas}h</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong>Dias Úteis/Trabalhados:</strong>
                            <span>${registro.diasUteis}/${registro.diasTrabalhados}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong>Valor Horas Extras:</strong>
                            <span>R$ ${registro.valorTotalHorasExtras.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong>Valor DSR:</strong>
                            <span>R$ ${registro.valorDSR.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <strong>Valor Total:</strong>
                            <span style="color: #27ae60; font-weight: bold;">R$ ${registro.valorTotalGeral.toFixed(2)}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            mostrarTela('historicoScreen');
        }

        // ℹ️ FUNÇÃO: Mostrar resumo
        function mostrarResumo() {
            const resumoDiv = document.getElementById('dadosResumo');
            const historicoFuncionario = historico[funcionarioLogado.senha] || [];
            const valorHora = funcionarioLogado.salario / 220;
            const valorHoraExtra = valorHora * 1.5;

            let totalHoras = 0;
            let totalValorHE = 0;
            let totalValorDSR = 0;
            let totalValorGeral = 0;

            historicoFuncionario.forEach(registro => {
                totalHoras += registro.horas;
                totalValorHE += registro.valorTotalHorasExtras;
                totalValorDSR += registro.valorDSR;
                totalValorGeral += registro.valorTotalGeral;
            });

            resumoDiv.innerHTML = `
                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #dee2e6;">
                        <span>Nome:</span>
                        <span>${funcionarioLogado.nome}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #dee2e6;">
                        <span>Salário Base:</span>
                        <span>R$ ${funcionarioLogado.salario.toFixed(2)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #dee2e6;">
                        <span>Valor Hora Normal:</span>
                        <span>R$ ${valorHora.toFixed(2)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #dee2e6;">
                        <span>Valor Hora Extra:</span>
                        <span>R$ ${valorHoraExtra.toFixed(2)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #dee2e6;">
                        <span>Total de Horas Extras:</span>
                        <span>${totalHoras.toFixed(1)}h</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #dee2e6;">
                        <span>Valor Total em Horas Extras:</span>
                        <span>R$ ${totalValorHE.toFixed(2)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #dee2e6;">
                        <span>Valor Total em DSR:</span>
                        <span>R$ ${totalValorDSR.toFixed(2)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Valor Total Geral:</span>
                        <span style="color: #27ae60; font-weight: bold;">R$ ${totalValorGeral.toFixed(2)}</span>
                    </div>
                </div>
            `;

            mostrarTela('resumoScreen');
        }

        // 🧭 FUNÇÃO: Navegação entre telas
        function mostrarTela(telaId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(telaId).classList.add('active');

            if (telaId === 'cadastroScreen') {
                atualizarListaProdutosCadastrados();
            } else if (telaId === 'comparacaoScreen') {
                carregarProdutosInternos();
            }
        }

        // 🚪 FUNÇÃO: Sair do sistema
        function sair() {
            funcionarioLogado = null;
            mostrarTela('loginScreen');
        }

        // Event Listeners
        document.getElementById('senha').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') fazerLogin();
        });

        document.getElementById('horasExtras').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calcularHorasExtras();
        });

        // Inicialização
        console.log('Sistema Wheel Tech - Com Departamentos carregado!');
        console.log('Produtos cadastrados:', todosProdutos.length);
        
        // Mostrar botão de exportação se houver produtos
        if (todosProdutos.length > 0) {
            document.getElementById('btnExportarExcel').style.display = 'block';
        }
    </script>
</body>
</html>